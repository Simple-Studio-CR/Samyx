<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="layout/layout :: head"></head>

<body class="fix-header card-no-border logo-center">
    <div id="main-wrapper">
        <header th:replace="layout/layout :: header"></header>
        <aside th:replace="layout/layout :: aside"></aside>
        <!-- ============================================================== -->
        <!-- Page wrapper  -->
        <!-- ============================================================== -->
        <div class="page-wrapper m-t-10">
            <!-- ============================================================== -->
            <!-- Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <div class="row page-titles">
                <div class="col-md-5 align-self-center">
                    <h3 th:if="${param.tp == null}"  class="text-themecolor" th:text="'Diseño de la proforma'"></h3>
                    <h3 th:if="${param.tp != null}"  class="text-themecolor" th:text="'Nota de Crédito para la factura #: ' + ${factura.consecutivo}"></h3>
                </div>
                <div class="col-md-7 align-self-center">
                    <ol th:if="${param.tp == null}" class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="javascript:void(0)" th:href="@{/proformas/}" th:text="'Lista de proformas'"></a>
                        </li>
                        <li class="breadcrumb-item active" th:text="'Proforma'"></li>
                    </ol>
                    <ol th:if="${param.tp != null}" class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="javascript:void(0)" th:href="@{/fe-documentos/}">Documentos emitidos</a>
                        </li>
                        <li class="breadcrumb-item active">Nota de crédito</li>
                    </ol>
                    
                </div>
            </div>

            <!-- ============================================================== -->
            <!-- End Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- Container fluid  -->
            <!-- ============================================================== -->
            <div class="container-fluid">
                <!-- ============================================================== -->
                <!-- Start Page Content -->
                <!-- ============================================================== -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body card-body-facturador">
                                <form id="formEmitirFactura" th:action="@{/proformas/emitir-factura}" th:object="${factura}" autocomplete="off" method="post">
                                    <div class="form-body">

                                        <input type="hidden" name="claveFeOld" th:value="${factura.clave}" />
                                        <input type="hidden" th:if="${param.tp == null}" id="_idf"  th:field="*{id}" />
                                        <input type="hidden" th:if="${param.tp == null}" th:field="*{numeroFactura}" />
                                        <input type="hidden" th:if="${param.tp == null}" th:field="*{estado}" />

                                        <div class="row">
                                            <div class="col-md-5 ">
                                                <h4 class="card-title" th:text="#{txt.informacion.basica}"></h4>
                                            </div>

                                            <div class="col-md-5">
                                                <h6 class="card-title"><i class="fa fa-building" aria-hidden="true"></i>&nbsp<span th:text="${SESSION_SUCURSAL}" th:remove="tag"></span> / <i class="fas fa-cash-register"></i>&nbsp;<span th:remove="tag" th:text="${SESSION_TERMINAL}"></span></h6>
                                            </div>

                                            <div class="col-md-2 align-right">
                                                <a style="color:#FFFFFF !important;" class="btn waves-effect waves-light btn-success btn-xs btn-terminales" th:href="@{/facturar/seleccionar-terminal}">
                                                    <i class="fas fa-cash-register"></i>&nbsp; [(#{btn.terminales})]
                                                </a>
                                            </div>

                                        </div>
                                        <hr class="linea-horizontal">
                                        <div class="row">

                                            <div class="col-sm-2 col-md-2" th:if="${jose}">
                                                <div class="form-group">
                                                    <label class="control-label" th:text="'Situación'"></label>
                                                    <select class="form-control _select21_" th:field="*{situacion}" required="required">
                                                        <option th:value="'normal'" th:text="#{txt.situacion.normal}"></option>
                                                        <option th:value="'contingencia'" th:text="#{txt.situacion.contingencia}"></option>
                                                        <option th:value="'sininternet'" th:text="#{txt.situacion.sininternet}"></option>
                                                    </select>
                                                </div>
                                            </div>
                                            <input type="hidden" name="situacion" value="normal" />

                                            <div class="col-sm-6 col-md-1">
                                                <div class="form-group">
                                                    <label class="control-label" th:text="#{txt.moneda}"></label>
                                                    <select class="form-control _select2_" th:field="*{moneda}" id="codMoneda" required="required">
                                                        <option th:each="k : ${listaMonedas}" th:value="${k.id}" th:attr="selected=${k.id == MONEDA_USUARIO ? 'selected' : null}" th:text="${k.simboloMoneda}"></option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-sm-6 col-md-1">
                                                <div class="form-group" style="position: relative;">
                                                    <label class="control-label" th:text="#{txt.tipo.de.cambio}"></label>
                                                    <input type="text" readonly="readonly" class="form-control" onkeypress="return validateFloatKeyPress(this,event);" value="1.00" th:field="*{tipoCambio}" id="tipoCambio" name="tipoCambio" required="required">
                                                </div>
                                            </div>

                                            <div class="col-sm-12 col-md-5">
                                                <div class="form-group" style="position: relative;">
                                                    <label class="control-label" th:text="'Actividades económicas'"></label>
                                                    <select class="form-control _select2_" th:field="*{codigoActividadEmisor}" required="required">
                                                        <option th:if="${factura.id != null}" th:each="k : ${listaActividades}" th:value="${k.codigoActividadEmisor}" th:text="${k.detalleActividad}"></option>
                                                        <option th:if="${factura.id == null}" th:attr="selected=${k.codigoActividadEmisor == session.SESSION_ACTIVIDAD_DEFAULT ? 'selected' : null}" th:each="k : ${listaActividades}" th:value="${k.codigoActividadEmisor}" th:text="${k.detalleActividad}"></option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div th:if="${param.tp == null}" class="col-sm-6 col-md-2">
                                                <div class="form-group">
                                                    <label class="control-label" th:text="#{txt.tipo.de.documento}"></label>
                                                    <select class="form-control _select21_" name="tipoDocumento" id="tipoDocumento" th:field="*{tipoDocumento}" required="required">
                                                        <option th:value="'PR'" th:text="'Proforma'"></option>
                                                        <option th:value="'FE'" th:text="#{txt.fe}"></option>
                                                        <option th:value="'ND'" th:text="#{txt.nd}"></option>
                                                        <option th:value="'NC'" th:text="#{txt.nc}"></option>
                                                        <option th:value="'TE'" th:text="#{txt.te}"></option>
                                                        <!--<option th:attr="selected=${'FEC' == TIPO_DOC_USUARIO ? 'selected' : null}" th:value="'FEC'" th:text="#{txt.fec}"></option>-->
                                                        <option th:value="'FEE'" th:text="#{txt.fee}"></option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div th:if="${#strings.equalsIgnoreCase(param.tp, 'NC')}" class="col-sm-6 col-md-2">
                                                <div class="form-group">
                                                    <label class="control-label" th:text="#{txt.tipo.de.documento}"></label>
                                                    <select class="form-control _select21_" name="tipoDocumento" id="tipoDocumento" th:field="*{tipoDocumento}" required="required">
                                                        <option th:value="'NC'" th:text="#{txt.nc}"></option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div th:if="${session.SESSION_SISTEMA_FARMACIA == 'S'}" class="col-sm-6 col-md-4 col-lg-2">
			                                 <div class="form-group">
			                                    <label class="control-label">Receta medica</label>
			                                    <select class="form-control _select21_" th:fiel="*{recetaMedico}" id="recetaMedico" required="required">
			                                       <option th:value="'N'">No</option>
			                                       <option th:value="'S'">Si</option>
			                                    </select>
			                                 </div>
			                              </div>

											</div>
                                            <hr class="linea-horizontal">
											<div class="row">
                                            <div class="col-sm-6 col-md-2">
                                                <div class="form-group">
                                                    <label class="control-label">[(#{txt.incluir.omitir})]</label>
                                                    <select class="form-control _select21_" id="omitirReceptor" name="omitirReceptor" required="required">
                                                        <option class="receptor-false" th:attr="selected=${factura.clienteContado != null and #strings.length(factura.clienteContado)>0 ? 'selected' : null}" th:value="'false'" th:text="#{txt.no.omitir.receptor}"></option>
                                                        <option class="receptor-true" th:attr="selected=${factura.clienteContado != null and #strings.length(factura.clienteContado)>0 ? 'selected' : null}" th:value="'true'" th:text="#{txt.omitir.receptor}"></option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                          
                                              <div class="col-md-4 datos-cliente">
                                                  <div class="form-group">
                                                      <label class="control-label">[(#{txt.busque.el.cliente})]</label>
                                                      <input type="hidden" id="inputClientesTipoIdentificacionHidden" th:value="${factura.cliente} != null ? ${factura.cliente.tipoDeIdentificacion.id}" />
                                                      <input type="hidden" id="inputClientesHidden" name="receptor" th:attr="name='receptor'" th:value="${factura.cliente} != null ? ${factura.cliente.id}" />
                                                      <input type="search" id="inputBuscarClientes" onclick="return this.select();" th:value="${factura.cliente} != null ? 'Identificación: ' + ${factura.cliente.identificacion} +', Cliente: '+ ${factura.cliente.nombreCompleto}" class="form-control" th:attr="placeholder=#{txt.digite.nombre.cliente}">
                                                      <a data-toggle="modal" data-target="#ModalNuevoCliente" class="btn btn-secondary btn-xs btn-cliente" href="#"><i th:attr="title=#{txt.agregar.nuevo.cliente}" data-toggle="tooltip" data-placement="top" class="fas fa-plus"></i>  Registrar cliente
                                                      </a>
                                                  </div>
                                              </div>
                                              <div class="col-md-3 datos-cliente">
                                                  <div class="form-group">
                                                      <label class="control-label">Correo</label>
                                                      <input type="email" id="inputCorreoCliente" class="form-control" onclick="return this.select();" th:value="${factura.cliente} != null ? ${factura.cliente.correo1}" name="correoCliente">
                                                  </div>
                                              </div>

                                              <div id="boxInputClienteContado" style="display: none;" th:style="${factura.clienteContado != null and #strings.length(factura.clienteContado)>0  ? 'display:block' : 'display:none' }" class="col-md-3">
                                                  <div class="form-group">
                                                      <label class="control-label">Cliente de contado</label>
                                                      <input type="text" id="inputClienteContado" name="inputClienteContado" th:value="${factura.clienteContado}" onclick="return this.select();" class="form-control" th:attr="placeholder='Nombre cliente de contado, campo opcional'">
                                                  </div>
                                              </div>
                                              
                                            <div id="boxInputCorreoContado" style="display: none;" th:if="${'true' == INCLUIR_OMITIR_RECEPTOR}" class="col-md-3">
		                                       <div class="form-group">
		                                          <label class="control-label">Envíar tiquete por correo</label>
		                                          <input type="text" id="inputCorreoContado" name="inputCorreoContado" onclick="return this.select();"  class="form-control" th:attr="placeholder='Correo electrónico cliente de contado, campo opcional'">
		                                       </div>
		                                    </div>
                                        </div>

                                        <input th:id="'moneda' + ${k.moneda.id}" th:attr="name='tp-'+${k.moneda.id}" type="hidden" th:each="k : ${listaTiposDeCambio}" th:value="${k.tipoDeCambio}" />

                                        <ul class="lista-tipo-cambio">
                                            [(#{txt.tipo.de.cambio.moneda})]
                                            <li th:each="k : ${listaTiposDeCambio}">
                                                <a href="#">[(${k.moneda.simboloMoneda}+' '+${#numbers.formatDecimal(k.tipoDeCambio, 0, 'COMMA', 2, 'POINT')})]</a>
                                            </li>
                                        </ul>

                                        <hr class="linea-horizontal">

                                        <div class="row">
                                            <div class="col-md-12">
                                                
                                                <hr class="linea-horizontal">
				                                 <div class="row">
				                                    <div class="col-md-3 col-lg-3">
				                                       <div class="" style="text-align: center;">
				                                          <input name="tipoBusqueda" type="radio" class="_tipoBusquedaProductos" value="S" id="tipoBusquedaS" th:checked="${TIPO_BUSQUEDA_PRODUCTO == 'S'}">
				                                          <label for="tipoBusquedaS">Escaner</label>
				                                          <input name="tipoBusqueda" type="radio" class="_tipoBusquedaProductos" value="M" id="tipoBusquedaM" th:checked="${TIPO_BUSQUEDA_PRODUCTO == 'M'}">
				                                          <label for="tipoBusquedaM">Manual</label>
				                                       </div>
				                                    </div>
				                                    <div class="col-md-9 col-lg-9">
				                                       <div class="form-group" style="position:relative">
				                                       	  <label class="txtLineasFactura">F7 - [(#{txt.lineas.factura})]</label>
				                                          <input autofocus="autofocus"  type="search" th:style="${TIPO_BUSQUEDA_PRODUCTO == 'S' ? 'display:block' : 'display:none'}" id="inputBuscarProductos"       onclick="return this.select();" class="form-control tipoBusquedaProductos" placeholder="Escanear código del producto">
				                                          <input autofocus="autofocus"  type="search" th:style="${TIPO_BUSQUEDA_PRODUCTO == 'M' ? 'display:block' : 'display:none'}" id="inputBuscarProductosManual" onclick="return this.select();" class="form-control tipoBusquedaProductos" placeholder="Digite el código o el nombre del producto">
				                                       </div>
				                                    </div>
				                                 </div>

                                                <div class="table-responsive">
                                                    <table id="cargarItemProductos" class="table color-bordered-table muted-bordered-table">
                                                        <thead>
				                                          <tr>
				                                             <th style="width: 5%" th:text="#{txt.factura.form.item.codigo}"></th>
				                                             <th style="width: 25%" th:text="#{txt.factura.form.item.producto}+' - '+#{txt.factura.form.item.unidad.de.medida}"></th>
				                                             <th style="width: 8%">[(${TXT_CANTIDAD_UNIDAD})]</th>
				                                             <th style="width: 8%" th:style="${TIPO_VENTA == 'A' ? 'display:none' : ''}">[(${TXT_FRACCIONES})]</th>
				                                             <th class="align-right" style="width: 8%" th:style="${TIPO_VENTA == 'A' ? 'display:none' : ''}">[(${TXT_PRECIO_UNIDAD})]</th>
				                                             <th class="align-right" style="width: 8%">[(${TXT_PRECIO_FRACCIONES})]</th>
				                                             <th style="width: 10%;" th:text="#{txt.factura.form.item.descuento}"></th>
				                                             <th class="align-right " style="width: 8%; " th:text="#{txt.factura.form.item.subtotal}"></th>
				                                             <th style="width: 10%; " th:text="#{txt.factura.form.item.impuesto}"></th>
				                                             <th class="align-right" style="width: 8%">Total linea</th>
				                                             <th style="width: 2%"></th>
				                                          </tr>
				                                       </thead>
                                                        <tbody id="loadLineasFactura">

                                                            <tr style="vertical-align: middle;" id="row_{ID}" th:attr="id='row_'+${k.producto.id}, data-id=${k.producto.id}" th:each="k : ${factura.items}">
                                                                <td class="d-none">
                                                                    <input th:if="${param.tp == null}" type="hidden" name="idLinea[]" th:value="${k.id}" />
                                                                    <input type="hidden" value="{ID}" th:value="${k.producto.id}" name="item_id[]" />
                                                                    <input type="hidden" value="{MONEDA}" th:value="${factura.moneda.id}" id="moneda_{ID}" th:attr="id='moneda_'+${k.producto.id}" />
                                                                </td>
                                                                <td id="codigo-{ID}" th:id="'codigo-'+${k.producto.id}">
                                                                    <span th:text="${k.producto.codigo}" th:remove="tag">{CODIGO}</span>
                                                                    <input type="hidden" name="codigoProducto[]" th:value="${k.producto.codigo}" value="{CODIGO}" />
                                                                </td>
                                                                <td style="position:relative">

                                                                    <div class="row" style="padding: 0;margin: 0;">
                                                                        <div class="col-sm-5 col-md-5" style="padding: 0;margin: 0;">
                                                                            <span style="font-size:0.75em;font-weight: 600;" class="productoGenerico"><span th:text="${k.producto.nombreProducto}" th:remove="tag">{NOMBRE_PRODUCTO}</span> <i th:text="${k.producto.unidadDeMedida.simbolo}">{UNIDAD_DE_MEDIDA}</i></span>
                                                                        </div>
                                                                        <div class="col-sm-6 col-md-6" style="padding: 0;margin: 0;">
                                                                            <input style="font-size:0.8em;" type="text" class="form-control" maxlength="160" name="detalleProducto[]" th:value="${k.detalleProducto != null && #strings.length(k.detalleProducto)>0 ? k.detalleProducto : ''}" placeholder="Detalle el producto" />
                                                                        </div>
                                                                        <div class="col-sm-1 col-md-1" style="padding: 0;margin: 0;">
                                                                            <a href="#" data-toggle="modal" data-target="#modalPartidaArancelaria{ID}" th:attr="data-target='#modalPartidaArancelaria'+${k.producto.id},data-id=${k.producto.id}" class="btn btn-secondary btn-xs btn-lineas-facturas btn-partida-arancelaria" data-id="{ID}">
                                                                                <i title="Partida arancelaria" class="fas fa-edit"></i>
                                                                            </a>

                                                                            <div class="modal fade" id="modalPartidaArancelaria{ID}" th:id="'modalPartidaArancelaria'+${k.producto.id}">
                                                                                <div class="modal-dialog" role="document">
                                                                                    <div class="modal-content ">
                                                                                        <div class="modal-header">
                                                                                            <h5 class="modal-title" th:text="#{txt.partida.arancelaria}"></h5>
                                                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                                <span aria-hidden="true">&times;</span>
                                                                                            </button>
                                                                                        </div>
                                                                                        <div class="modal-body">
                                                                                            <div class="row">
                                                                                                <div class="col-sm-12 col-md-12">
                                                                                                    <div class="form-group">
                                                                                                        <label class="control-label" th:text="#{txt.indique.partida.arancelaria}"></label>
                                                                                                        <input type="text" maxlength="12" class="form-control" id="partidaArancelaria" th:id="'_partidaArancelaria' + ${k.producto.id}" name="partidaArancelaria[]" data-um="{UNIDAD_DE_MEDIDA}" th:attr="data-um=${k.producto.unidadDeMedida.simbolo}">
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="modal-footer">
                                                                                            <button type="button" class="btn btn-primary" data-dismiss="modal">Cerrar</button>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                    </div>

                                                                    <input type="hidden" name="codigoProducto1[]" value="{CODIGO_PRODUCTO1}" th:value="${k.producto.tipoProducto.id}" />
                                                                    <input type="hidden" name="codigoProducto2[]" value="{CODIGO_PRODUCTO2}" th:value="${k.producto.codigo}" />
                                                                    <input type="hidden" name="nombreProducto[]" value="{NOMBRE_PRODUCTO}" th:value="${k.producto.nombreProducto}" />
                                                                    <input type="hidden" id="unidadDeMedida{ID}" th:id="'unidadDeMedida'+${k.producto.id}" name="unidadDeMedida[]" value="{UNIDAD_DE_MEDIDA}" th:value="${k.producto.unidadDeMedida.simbolo}" />

                                                                    <input type="hidden" id="_condicionProducto{ID}" th:id="'_condicionProducto'+${k.producto.id}" value="{CONDICION_PRODUCTO}" th:value="${k.producto.productoExento}" />
                                                                    <input type="hidden" id="_precio{ID}" th:id="'_precio'+${k.producto.id}" value="{PRECIO}" th:value="${k.precioUnitario}" />

                                                                    <input type="hidden" id="montoTotal_{ID}" th:id="'montoTotal_'+${k.producto.id}" name="montoTotal[]" value="0" th:value="${k.montoTotal}" class="form-control align-right number-format" readonly="readonly" />

                                                                    <input type="hidden" id="_impuesto{ID}" th:id="'_impuesto'+${k.producto.id}" value="{IMPUESTO}" />
                                                                    <input type="hidden" id="_unidadDeMedida{ID}" th:id="'_unidadDeMedida'+${k.producto.id}" th:value="${k.producto.unidadDeMedida.simbolo}" value="{UNIDAD_DE_MEDIDA}" />
                                                                </td>
                                                                
											                   <td>
												               		<input type="hidden" id="tipoVenta_{ID}" th:id="'tipoVenta_' + ${k.producto.id}" th:value="${k.producto.tipoVenta}" name="tipoVentaLinea[]" value="0" class="form-control"/>
												               		<input type="hidden" id="fraccionesPorUnidad_{ID}" th:id="'fraccionesPorUnidad_' + ${k.producto.id}" name="fraccionesPorUnidad[]" th:value="${k.fraccionesPorUnidad}" value="0" class="form-control"/>
												               		
												               		
												               		<input th:if="${k.producto.tipoVenta == 'F' && param.tp == null}" th:attr="oninput=|itemsHelper.calcularImporte(${k.producto.id},document.getElementById('precio_'+${k.producto.id}).value,document.getElementById('impuesto_'+${k.producto.id}).value,document.getElementById('_condicionProducto'+${k.producto.id}).value, this.value, document.getElementById('descuento_'+${k.producto.id}).value,'${k.producto.unidadDeMedida.simbolo}')|" type="text" value="1" th:value="${k.unidades}" onclick="return this.select();" onkeypress="return validateFloatKeyPress(this,event);" name="cantidad[]" id="cantidad_{ID}" th:id="'cantidad_'+${k.producto.id}" class="form-control select-all align-right " oninput="itemsHelper.calcularImporte({ID}, document.getElementById('precio_'+{ID}).value, document.getElementById('impuesto_'+{ID}).value, document.getElementById('_condicionProducto'+{ID}).value, this.value, document.getElementById('descuento_'+{ID}).value, '{UNIDAD_DE_MEDIDA}');" />
                                                                    
                                                                    
                                                                    
                                                                    <input th:if="${k.producto.tipoVenta == 'F' && #strings.equalsIgnoreCase(param.tp, 'NC')}" th:attr="oninput=|itemsHelper.calcularImporte(${k.producto.id},document.getElementById('precio_'+${k.producto.id}).value,document.getElementById('impuesto_'+${k.producto.id}).value,document.getElementById('_condicionProducto'+${k.producto.id}).value, this.value, document.getElementById('descuento_'+${k.producto.id}).value,'${k.producto.unidadDeMedida.simbolo}')|" type="text" value="1" th:value="${k.unidades}" onclick="return this.select();" onkeypress="return validateFloatKeyPress(this,event);" name="cantidad[]" id="cantidad_{ID}" th:id="'cantidad_'+${k.producto.id}" class="form-control select-all align-right " oninput="itemsHelper.calcularImporte({ID}, document.getElementById('precio_'+{ID}).value, document.getElementById('impuesto_'+{ID}).value, document.getElementById('_condicionProducto'+{ID}).value, this.value, document.getElementById('descuento_'+{ID}).value, '{UNIDAD_DE_MEDIDA}');" />
                                                                    
                                                                    
                                                                    
                                                                    
                                                                    
                                                                    <input th:if="${k.producto.tipoVenta == 'U'}" th:attr="oninput=|itemsHelper.calcularImporte(${k.producto.id},document.getElementById('precio_'+${k.producto.id}).value,document.getElementById('impuesto_'+${k.producto.id}).value,document.getElementById('_condicionProducto'+${k.producto.id}).value, this.value, document.getElementById('descuento_'+${k.producto.id}).value,'${k.producto.unidadDeMedida.simbolo}')|" type="text" value="1" th:value="${k.cantidad}" onclick="return this.select();" onkeypress="return validateFloatKeyPress(this,event);" name="cantidad[]" id="cantidad_{ID}" th:id="'cantidad_'+${k.producto.id}" class="form-control select-all align-right " oninput="itemsHelper.calcularImporte({ID}, document.getElementById('precio_'+{ID}).value, document.getElementById('impuesto_'+{ID}).value, document.getElementById('_condicionProducto'+{ID}).value, this.value, document.getElementById('descuento_'+{ID}).value, '{UNIDAD_DE_MEDIDA}');" />
												               		
												               </td>
												               <td th:style="${TIPO_VENTA == 'A' ? 'display:none' : ''}">
												               		<input th:readonly="${k.producto.tipoVenta == 'U'}" type="text" th:value="${k.fraccion}" onclick="return this.select();" onkeypress="return validateFloatKeyPress(this,event);" name="fraccion[]" id="fraccion_{ID}" th:id="'fraccion_' + ${k.producto.id}" class="form-control select-all retorna-cero align-right" oninput="itemsHelper.calcularImporte({ID}, document.getElementById('precioFraccion_'+{ID}).value, document.getElementById('impuesto_'+{ID}).value, document.getElementById('_condicionProducto'+{ID}).value, this.value, document.getElementById('descuento_'+{ID}).value, '{UNIDAD_DE_MEDIDA}');" th:attr="oninput=|itemsHelper.calcularImporte(${k.producto.id}, document.getElementById('precioFraccion_'+${k.producto.id}).value, document.getElementById('impuesto_'+${k.producto.id}).value, document.getElementById('_condicionProducto'+${k.producto.id}).value, this.value, document.getElementById('descuento_'+${k.producto.id}).value,  '${k.producto.unidadDeMedida.simbolo}')|"/>
												               </td>

												                
                                                                <td>
                                                                	<input th:if="${#strings.equals(MODIFICA_PRECIO_FACTURACION,'true') && k.producto.tipoVenta == 'F'}" onclick="return this.select();" th:attr="oninput=|itemsHelper.calcularImporte(${k.producto.id},this.value,document.getElementById('impuesto_'+${k.producto.id}).value,document.getElementById('_condicionProducto'+${k.producto.id}).value, document.getElementById('cantidad_'+${k.producto.id}).value, document.getElementById('descuento_'+${k.producto.id}).value,'${k.producto.unidadDeMedida.simbolo}')|" oninput="itemsHelper.calcularImporte({ID}, this.value, document.getElementById('impuesto_'+{ID}).value, document.getElementById('_condicionProducto'+{ID}).value, document.getElementById('cantidad_'+{ID}).value, document.getElementById('descuento_'+{ID}).value, '{UNIDAD_DE_MEDIDA}');" type="text" id="precio_{ID}" th:id="'precio_'+${k.producto.id}" name="precioUnitario[]" onkeypress="return validateFloatKeyPress(this,event);" value="{PRECIO}" th:value="${k.precioUnitario * k.cantidad}" class="form-control align-right" />
                                                                    <input th:if="${#strings.equals(MODIFICA_PRECIO_FACTURACION,'false') && k.producto.tipoVenta == 'F'}" readonly="readonly" onclick="return this.select();" type="text" id="precio_{ID}" th:id="'precio_'+${k.producto.id}" name="precioUnitario[]" onkeypress="return validateFloatKeyPress(this,event);" value="{PRECIO}" th:value="${k.precioUnitario}" class="form-control align-right" />
                                                                    
                                                                	<input th:if="${#strings.equals(MODIFICA_PRECIO_FACTURACION,'true') && k.producto.tipoVenta == 'U'}" onclick="return this.select();" th:attr="oninput=|itemsHelper.calcularImporte(${k.producto.id},this.value,document.getElementById('impuesto_'+${k.producto.id}).value,document.getElementById('_condicionProducto'+${k.producto.id}).value, document.getElementById('cantidad_'+${k.producto.id}).value, document.getElementById('descuento_'+${k.producto.id}).value,'${k.producto.unidadDeMedida.simbolo}')|" oninput="itemsHelper.calcularImporte({ID}, this.value, document.getElementById('impuesto_'+{ID}).value, document.getElementById('_condicionProducto'+{ID}).value, document.getElementById('cantidad_'+{ID}).value, document.getElementById('descuento_'+{ID}).value, '{UNIDAD_DE_MEDIDA}');" type="text" id="precio_{ID}" th:id="'precio_'+${k.producto.id}" name="precioUnitario[]" onkeypress="return validateFloatKeyPress(this,event);" value="{PRECIO}" th:value="${k.precioUnitario}" class="form-control align-right" />
                                                                    <input th:if="${#strings.equals(MODIFICA_PRECIO_FACTURACION,'false') && k.producto.tipoVenta == 'U'}" readonly="readonly" onclick="return this.select();" type="text" id="precio_{ID}" th:id="'precio_'+${k.producto.id}" name="precioUnitario[]" onkeypress="return validateFloatKeyPress(this,event);" value="{PRECIO}" th:value="${k.precioUnitario}" class="form-control align-right" />
                                                                </td>
                                                                
                                                                <td th:style="${TIPO_VENTA == 'A' ? 'display:none' : ''}">
												                   <input th:if="${#strings.equals(MODIFICA_PRECIO_FACTURACION,'true')}" th:readonly="${k.producto.tipoVenta == 'U'}" onclick="return this.select();"  oninput="itemsHelper.calcularImporte({ID}, this.value, document.getElementById('impuesto_'+{ID}).value, document.getElementById('_condicionProducto'+{ID}).value, document.getElementById('cantidad_'+{ID}).value, document.getElementById('descuento_'+{ID}).value, '{UNIDAD_DE_MEDIDA}');" type="text" id="precioFraccion_{ID}" th:id="${'precioFraccion_' + k.producto.id}" name="precioFraccion[]" onkeypress="return validateFloatKeyPress(this,event);" th:value="${k.precioFraccion}" class="form-control align-right"  />
												                   <input th:if="${#strings.equals(MODIFICA_PRECIO_FACTURACION,'false')}" readonly="readonly" type="text" id="precioFraccion_{ID}" th:id="${'precioFraccion_' + k.producto.id}" name="precioFraccion[]" th:value="${k.precioFraccion}" value="{PRECIO_FRACCION}" class="form-control align-right"  />
												                </td>
                                                                <td>
                                                                	<input th:if="${#strings.equals(APLICA_DESCUENTO,'true')}" th:attr="data-d=${MONTO_MAXIMO_DESCUENTO},oninput=|itemsHelper.calcularImporte(${k.producto.id}, document.getElementById('precio_'+${k.producto.id}).value, document.getElementById('impuesto_'+${k.producto.id}).value,document.getElementById('_condicionProducto'+${k.producto.id}).value, document.getElementById('cantidad_'+${k.producto.id}).value, this.value,'${k.producto.unidadDeMedida.simbolo}')|" style="width: 40%; display: inline-block;" name="descuento[]" type="text" onclick="return this.select();" onkeypress="return validateFloatKeyPress(this,event);" value="0" th:value="${#numbers.formatDecimal(k.porcentajeDescuento, 0, 'POINT', 2, 'POINT')}" id="descuento_{ID}" th:id="'descuento_'+${k.producto.id}" class="align-right form-control" oninput="itemsHelper.calcularImporte({ID}, document.getElementById('precio_'+{ID}).value, document.getElementById('impuesto_'+{ID}).value, document.getElementById('_condicionProducto'+{ID}).value, document.getElementById('cantidad_'+{ID}).value, this.value, '{UNIDAD_DE_MEDIDA}');" />
                                                                    <input th:if="${#strings.equals(APLICA_DESCUENTO,'false')}" readonly="readonly" style="width: 40%; display: inline-block;" name="descuento[]" type="text" onclick="return this.select();" onkeypress="return validateFloatKeyPress(this,event);" value="0" th:value="${#numbers.formatDecimal(k.porcentajeDescuento, 0, 'POINT', 2, 'POINT')}" id="descuento_{ID}" th:id="'descuento_'+${k.producto.id}" class="align-right form-control" />
                                                                    <input style="width: 55%; display: inline-block;" name="descuentoTotal[]" readonly="readonly" type="text" value="0" class="align-right form-control number-format" id="monto_descuento_{ID}" th:id="'monto_descuento_'+${k.producto.id}" th:value="${k.montoDescuento}" />
                                                                </td>
                                                                <td>
                                                                    <input type="text" id="subtotal_{ID}" th:id="'subtotal_'+${k.producto.id}" name="subtotal[]" value="0" th:value="${k.subTotal}" class="form-control align-right number-format" readonly="readonly" />
                                                                </td>
                                                                <td style="position:relative">

                                                                    <input type="hidden" id="totalLineasImpuesto{ID}" th:id="'totalLineasImpuesto'+${k.producto.id}" name="totalLineasImpuesto[]" />

                                                                    <input style="width: 20%; display: inline-block;" readonly="readonly" name="impuesto[]" type="text" value="{IMPUESTO}" th:value="${k.porcentajeIva}" class="form-control align-right" id="impuesto_{ID}" th:id="'impuesto_'+${k.producto.id}" />
                                                                    <input style="width: 60%; display: inline-block;" readonly="readonly" name="impuestoTotal[]" type="text" value="0" th:value="${k.totalImpuestos}" class="form-control align-right number-format" id="impuesto_total_{ID}" th:id="'impuesto_total_'+${k.producto.id}" th:attr="data-diva=${k.producto.aplicaDevolucionIva}" />
                                                                    <input style="width: 20%; display: none;" readonly="readonly" name="impuestoNeto[]" type="text" value="0" th:value="${k.impuestoNeto}" class="form-control align-right number-format" id="impuesto_neto_{ID}" th:id="'impuesto_neto_'+${k.producto.id}" />
                                                                    <a href="#" data-toggle="modal" data-target="#modalImpuestos{ID}" class="btn btn-secondary btn-xs btn-lineas-facturas btn-exonera" data-id="{ID}" th:attr="data-id=${k.producto.id},data-target='#modalImpuestos'+${k.producto.id}">
                                                                        <i class="fas fa-edit"></i>
                                                                    </a>

                                                                    <div class="modal fade" id="modalImpuestos{ID}" th:id="'modalImpuestos'+${k.producto.id}">
                                                                        <div class="modal-dialog modal-xl" role="document">
                                                                            <div class="modal-content ">
                                                                                <div class="modal-header">
                                                                                    <h5 class="modal-title">Impuestos</h5>
                                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                        <span aria-hidden="true">&times;</span>
                                                                                    </button>
                                                                                </div>
                                                                                <div class="modal-body">
                                                                                    <div class="table-responsive">

                                                                                        <table class="table color-bordered-table muted-bordered-table">
                                                                                            <thead>
                                                                                                <tr>
                                                                                                  <th style="width: 25%;">Impuesto</th>
														                                          <th style="width: 5%;" class="align-right">%</th>
														                                          <th style="width: 8%;" class="align-right">Monto</th>
														                                          <th style="width: 2%;">Exonerar</th>
														                                          <th style="width: 5%;" class="align-right">% Porcentaje</th>
														                                          <th style="width: 10%;" class="align-right">Monto</th>
														                                          <th style="width: 10%;" class="align-center">Acciones</th>
                                                                                                </tr>
                                                                                            </thead>
                                                                                            <tbody id="gridImpuestos{ID}" th:id="'gridImpuestos'+${k.producto.id}">

                                                                                                <tr th:each="j : ${k.impuestosItemFactura}">
                                                                                                    <td>
                                                                                                        <input type="hidden" name="idLineaImpuesto[]" th:attr="name='idLineaImpuesto' + ${k.id} + '[]'" th:value="${j.id}" />
                                                                                                        <input id="_impuestoTarifaIva'+ valuePrincipal + value.codigosTarifasIva.id+'" th:attr="id='_impuestoTarifaIva' + ${k.producto.id} + ${j.codigoTarifaIva.id}, name='impuestoTarifaIva'+${k.producto.id}+'[]'" name="impuestoTarifaIva'+${k.producto.id}+'[]" type="hidden" value="0'+ value.codigosTarifasIva.id +'" th:value="'0'+${j.codigoTarifaIva.id}" />
                                                                                                        <input readonly="readonly" class="form-control" type="text" name="impuestosDetalle[]" value="'+ value.impuesto.detalleImpuesto +'" id="_impuestosDetalle' + valuePrincipal + value.impuesto.id +'" th:attr="id='_impuestosDetalle' + ${k.producto.id} + ${j.codigoTarifaIva.id}" th:value="${j.impuesto.detalleImpuesto}" />
                                                                                                    </td>
                                                                                                    <td>
                                                                                                        <input type="hidden" name="impuestosId'+ui.item.valuePrincipal+'[]" th:attr="name='impuestosId'+${k.producto.id}+'[]'" value="'+value.impuesto.id+'" th:value="${j.impuesto.id}" />

                                                                                                        <input readonly="readonly" id="exonera1'+ ui.item.valuePrincipal + value.impuesto.id + '" th:id="'exonera1' + ${k.producto.id} + ${j.impuesto.id}" type="text" name="Impuestoimpuestos'+ui.item.valuePrincipal+'[]" value="'+ value.porcentaje +'" th:value="${j.tarifa}" data-i="'+value.porcentaje+'" th:attr="data-i=${j.tarifa}, name='Impuestoimpuestos'+${k.producto.id}+'[]'" class="form-control align-right" />
                                                                                                    </td>
                                                                                                    <td>
                                                                                                        <input readonly="readonly" name="impuestosMonto'+ui.item.valuePrincipal+'[]" th:attr="name='impuestosMonto'+${k.producto.id}+'[]', data-tarifa=${j.tarifa}" id="exonera2' + ui.item.valuePrincipal + value.impuesto.id +'" th:id="'exonera2' + ${k.producto.id} + ${j.impuesto.id}" type="text" value="0" th:value="${j.monto}" class="form-control align-right number-format exonera2'+ui.item.valuePrincipal+' " th:classappend="'exonera2' + ${k.producto.id}" data-tarifa="'+value.porcentaje+'" />
                                                                                                    </td>
                                                                                                    <td>
                                                                                                        <input name="exoneraCheckBox'+ui.item.valuePrincipal+'[]" th:attr="name='exoneraCheckBox'+${k.producto.id}+'[]', onChange=|exoneraChange(${j.impuesto.id}, ${j.tarifa}, ${k.producto.productoExento}, ${k.producto.id})|" id="checkBoxExonera' + ui.item.valuePrincipal + value.impuesto.id + '" th:id="'checkBoxExonera' + ${k.producto.id} + ${j.impuesto.id}" class="form-control align-center" type="checkbox" onChange="exoneraChange('+value.impuesto.id+','+ value.porcentaje +','+ui.item.productoExento+','+ui.item.valuePrincipal+')" />
                                                                                                    </td>
                                                                                                    <td>
                                                                                                        <input onclick="return this.select();" value="0" maxlength="3" name="exoneraPorcentajeExoneracion'+ui.item.valuePrincipal+'[]" data-iva-id="'+value.impuesto.id+'" id="exonera3' + ui.item.valuePrincipal + value.impuesto.id + '" th:id="'exonera3' + ${k.producto.id} + ${j.impuesto.id}" onKeyup="exoneraKeyUp('+value.impuesto.id+','+ value.porcentaje +','+ui.item.valuePrincipal+',this.value)" th:attr="onKeyup=|exoneraKeyUp(${j.impuesto.id}, ${j.tarifa}, ${k.producto.id}, this.value)|, name='exoneraPorcentajeExoneracion' + ${k.producto.id} +'[]', data-iva-id=${j.impuesto.id}, data-producto=${k.producto.id}" type="text" class="form-control align-right num-integer input-exoneracion" />
                                                                                                    </td>
                                                                                                    <td>
                                                                                                        <input value="0" readonly="readonly" th:attr="name='montoExoneracion'+ ${k.producto.id} +'[]'" id="exonera4' + ui.item.valuePrincipal + value.impuesto.id + '" th:id="'exonera4' + ${k.producto.id} + ${j.impuesto.id}" type="text" class="form-control number-format input-exoneracion align-right" />
                                                                                                    </td>
                                                                                                    <td class="text-center">
                                                                                                    	<button id="btn-change-impuesto'+ valuePrincipal + value.impuesto.id + '" data-p='+valuePrincipal+' data-i='+value.impuesto.id+' data-t='+value.codigosTarifasIva.id+' th:attr="id='btn-change-impuesto'+${k.producto.id}+${j.impuesto.id}+${j.codigoTarifaIva.id}, data-p=${k.producto.id}, data-i=${j.impuesto.id}, data-t=${j.codigoTarifaIva.id}" class="btn-change-impuesto btn btn-xs btn-success" data-toggle="modal" data-target=".modalImpuestos">
                                                                                                    		<i class="fas fa-edit"></i> Modificar impuesto
                                                                                                    	</button>
                                                                                                    </td>
                                                                                                </tr>
                                                                                            </tbody>
                                                                                        </table>

                                                                                        <input id="modalLinea{ID}" th:id="'modalLinea'+${k.producto.id}" type="hidden" />
                                                                                        <input id="modalCantidad{ID}" th:id="'modalCantidad'+${k.producto.id}" type="hidden" />
                                                                                        <input id="modalDescuento{ID}" th:id="'modalDescuento'+${k.producto.id}" type="hidden" />
                                                                                        <input id="modalUnidadDeMedida{ID}" th:id="'modalUnidadDeMedida'+${k.producto.id}" type="hidden" />

                                                                                    </div>
                                                                                </div>
                                                                                <div class="modal-footer">
                                                                                    <button type="button" class="btn btn-inverse" data-dismiss="modal"><i class="fas fa-window-close"></i> Cerrar</button>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <input type="hidden" value="0" th:value="${
												k.producto.productoExento == '1' && 
												(k.producto.unidadDeMedida.simbolo == 'Al' 
												|| k.producto.unidadDeMedida.simbolo == 'Alc' 
												|| k.producto.unidadDeMedida.simbolo == 'Cm'
												|| k.producto.unidadDeMedida.simbolo == 'I' 
												|| k.producto.unidadDeMedida.simbolo == 'Os'
												|| k.producto.unidadDeMedida.simbolo == 'Sp' 
												|| k.producto.unidadDeMedida.simbolo == 'Spe'
												|| k.producto.unidadDeMedida.simbolo == 'St' 
												|| k.producto.unidadDeMedida.simbolo == 'h' 
												|| k.producto.unidadDeMedida.simbolo == 's' 
												|| k.producto.unidadDeMedida.simbolo == 'd')} ? ${k.cantidad * k.precioUnitario} : '0.00'" id="totalServiciosGravados_{ID}" th:id="'totalServiciosGravados_'+${k.producto.id}" />

                                                                    <input type="hidden" value="0" th:value="${
												k.producto.productoExento == '2' && 
												(k.producto.unidadDeMedida.simbolo == 'Al' 
												|| k.producto.unidadDeMedida.simbolo == 'Alc' 
												|| k.producto.unidadDeMedida.simbolo == 'Cm'
												|| k.producto.unidadDeMedida.simbolo == 'I' 
												|| k.producto.unidadDeMedida.simbolo == 'Os'
												|| k.producto.unidadDeMedida.simbolo == 'Sp' 
												|| k.producto.unidadDeMedida.simbolo == 'Spe'
												|| k.producto.unidadDeMedida.simbolo == 'St' 
												|| k.producto.unidadDeMedida.simbolo == 'h' 
												|| k.producto.unidadDeMedida.simbolo == 's'
												|| k.producto.unidadDeMedida.simbolo == 'd')} ? ${k.cantidad * k.precioUnitario} : '0.00'" id="totalServiciosExentos_{ID}" th:id="'totalServiciosExentos_'+${k.producto.id}" />
                                                                    <input type="hidden" value="0" id="totalServExonerado_{ID}" th:id="'totalServExonerado_'+${k.producto.id}" />

                                                                    <input type="hidden" value="0" th:value="${
												k.producto.productoExento == '1' && 
												(k.producto.unidadDeMedida.simbolo != 'Al' 
												|| k.producto.unidadDeMedida.simbolo != 'Alc' 
												|| k.producto.unidadDeMedida.simbolo != 'Cm'
												|| k.producto.unidadDeMedida.simbolo != 'I' 
												|| k.producto.unidadDeMedida.simbolo != 'Os'
												|| k.producto.unidadDeMedida.simbolo != 'Sp' 
												|| k.producto.unidadDeMedida.simbolo != 'Spe'
												|| k.producto.unidadDeMedida.simbolo != 'St' 
												|| k.producto.unidadDeMedida.simbolo == 'h' 
												|| k.producto.unidadDeMedida.simbolo == 's'
												|| k.producto.unidadDeMedida.simbolo != 'd')} ? ${k.cantidad * k.precioUnitario} : '0.00'" id="totalMercanciaGravadas_{ID}" th:id="'totalMercanciaGravadas_'+${k.producto.id}" />
                                                                    <input type="hidden" value="0" th:value="${
												k.producto.productoExento == '2' && 
												(k.producto.unidadDeMedida.simbolo != 'Al' 
												|| k.producto.unidadDeMedida.simbolo != 'Alc' 
												|| k.producto.unidadDeMedida.simbolo != 'Cm'
												|| k.producto.unidadDeMedida.simbolo != 'I' 
												|| k.producto.unidadDeMedida.simbolo != 'Os'
												|| k.producto.unidadDeMedida.simbolo != 'Sp' 
												|| k.producto.unidadDeMedida.simbolo != 'Spe'
												|| k.producto.unidadDeMedida.simbolo != 'St' 
												|| k.producto.unidadDeMedida.simbolo == 'h' 
												|| k.producto.unidadDeMedida.simbolo == 's'
												|| k.producto.unidadDeMedida.simbolo != 'd')} ? ${k.cantidad * k.precioUnitario} : '0.00'" id="totalMercanciasExentas_{ID}" th:id="'totalMercanciasExentas_'+${k.producto.id}" />
                                                                    <input type="hidden" value="0" id="totalMercExonerada_{ID}" th:id="'totalMercExonerada_'+${k.producto.id}" />

                                                                    <input type="hidden" value="0" th:value="${k.producto.productoExento == '1'} ? ${k.cantidad * k.precioUnitario} : '0.00'" id="totalGravados_{ID}" th:id="'totalGravados_'+${k.producto.id}" />
                                                                    <input type="hidden" value="0" th:value="${k.producto.productoExento == '2'} ? ${k.cantidad * k.precioUnitario} : '0.00'" id="totalExentos_{ID}" th:id="'totalExentos_'+${k.producto.id}" />
                                                                    <input type="hidden" value="0" id="totalExonerado_{ID}" th:id="'totalExonerado_'+${k.producto.id}" />

                                                                    <input type="hidden" value="0" th:value="${k.cantidad * k.precioUnitario}" id="totalVenta_{ID}" th:id="'totalVenta_'+${k.producto.id}" />
                                                                    <input type="hidden" value="0" id="totalVentaNeta_{ID}" th:id="'totalVentaNeta_'+${k.producto.id}" />
                                                                    <input type="hidden" value="0" id="totalFactura_{ID}" th:id="'totalFactura_'+${k.producto.id}" />
                                                                </td>
                                                                <td class="align-right">
                                                                    <input type="text" id="total_importe_{ID}" th:id="'total_importe_'+${k.producto.id}" th:value="${k.montoTotalLinea}" name="totalLinea[]" value="0" class="form-control align-right number-format" readonly="readonly" />
                                                                </td>
                                                                <td style="position:relative;">
                                                                    <a href="#" class="btn btn-secondary btn-delete-row btn-xs btn-lineas-facturas" th:attr="onclick=|event.preventDefault(); itemsHelper.eliminarLineaFactura(${k.producto.id});|,data-id=${k.id}" onclick="event.preventDefault(); itemsHelper.eliminarLineaFactura({ID});">
                                                                        <i class="fas fa-trash"></i>
                                                                    </a>
                                                                </td>
                                                            </tr>

                                                        </tbody>
                                                        <tfoot>
				                                       	<tr>
				                                       		<td th:if="${TIPO_VENTA == 'A'}" colspan="9"> 
				                                       			<span class="font-weight-bold">Total de lineas:</span> <span class="badge badge-warning font-weight-bold" id="totalLineasFactura"></span> / <span class="font-weight-bold font-weight-bold">Cantidad productos:</span> <span class="badge badge-warning" id="totalProductos"></span>
				                                       		</td>
				                                       		<td th:if="${TIPO_VENTA == 'B'}" colspan="11"> 
				                                       			<span class="font-weight-bold">Total de lineas:</span> <span class="badge badge-warning font-weight-bold" id="totalLineasFactura"></span> / <span class="font-weight-bold font-weight-bold">Cantidad productos:</span> <span class="badge badge-warning" id="totalProductos"></span>
				                                       		</td>
				                                       	</tr>
				                                       </tfoot>
                                                    </table>
                                                </div>
                                            </div>

                                           

                                        </div>

                                        <nav>
										  <div class="nav nav-tabs" id="nav-tab" role="tablist">
										    <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-observaciones" role="tab" aria-controls="nav-observaciones" aria-selected="true">Observaciones</a>
										    <a class="nav-item nav-link" id="nav-exoneracion-tab" data-toggle="tab" href="#nav-exoneracion" role="tab" aria-controls="nav-exoneracion" aria-selected="false">Exoneración</a>
										    <a class="nav-item nav-link" id="nav-referencias-tab" data-toggle="tab" href="#nav-referencias" role="tab" aria-controls="nav-referencias" aria-selected="false">Referencia a otros documentos</a>
										    <a class="nav-item nav-link" id="nav-otros-cargos-tab" data-toggle="tab" href="#nav-otros-cargos" role="tab" aria-controls="nav-otros-cargos" aria-selected="false">Otros cargos</a>
										    
										  </div>
										</nav>
										<div class="tab-content" id="nav-tabContent">
										  <div class="tab-pane fade show active" id="nav-observaciones" role="tabpanel" aria-labelledby="nav-observaciones">
	
										  		<div class="row m-t-10">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                        	<label class="control-label">Agregue una observación o nota a la factura</label>
                                                            <textarea rows="2" cols="" name="notaFactura" class="form-control" maxlength="255" th:attr="placeholder=#{txt.observacion.factura}">[(${factura.otros})]</textarea>
                                                        </div>
                                                    </div>
                                                </div>
										  		
										  </div>
										  <div class="tab-pane fade" id="nav-exoneracion" role="tabpanel" aria-labelledby="nav-exoneracion-tab">
										  		<div class="row">
		                                            <div class="col-md-12">
		                                                <h4 class="card-title p-t-10" th:text="'Exoneración'"></h4>
		                                            </div>
		
		                                            <div class="col-sm-2 col-md-3">
		                                                <div class="form-group">
		                                                    <label class="control-label" th:text="'Tipo de exoneración exoneración'"></label>
		                                                    <select name="exoneraTipoDocumentoExonera" id="exoneraTipoDocumentoExonera" class="form-control _select21_">
		                                                        <option value="" selected="selected">Seleccione un elemento</option>
		                                                        <option th:each="j : ${listaTipoDocsExonera}" th:value="${j.id}" th:text="${j.exoneracionOAutorizacion}"></option>
		                                                    </select>
		                                                </div>
		                                            </div>
		                                            <div class="col-sm-2 col-md-3">
		                                                <div class="form-group">
		                                                    <label class="control-label" th:text="'Número de documento de exoneración'"></label>
		                                                    <input maxlength="40" name="exoneraNumero" id="exoneraNumero" onclick="return this.select();" placeholder="Digite número de documento de exoneración" type="text" class="form-control">
		
		                                                </div>
		                                            </div>
		
		                                            <div class="col-sm-2 col-md-3">
		                                                <div class="form-group">
		                                                    <label class="control-label" th:text="'Nombre de institución que exonera'"></label>
		                                                    <input maxlength="160" name="exoneraInstitucion" id="exoneraInstitucion" onclick="return this.select();" placeholder="Digite nombre de institución que exonera" type="text" class="form-control">
		
		                                                </div>
		                                            </div>
		
		                                            <div class="col-sm-2 col-md-3">
		                                                <div class="form-group">
		                                                    <label class="control-label" th:text="'Fecha emsión documento de exoneración'"></label>
		                                                    <div class="input-group">
		                                                        <input type="text" name="exoneraFechaEmision" id="exoneraFechaEmision" class="form-control align-right dd-mm-yyyy" placeholder="dd/mm/yyyy"><span class="input-group-addon"><i class="fa fa-calendar"
											                    aria-hidden="true"></i></span>
		                                                    </div>
		                                                </div>
		                                            </div>
		                                        </div>
										  </div>
										  <div class="tab-pane fade" id="nav-referencias" role="tabpanel" aria-labelledby="nav-referencias-tab">
										  		<div class="row">
		                                            <div class="col-md-10">
		                                                <h4 class="card-title p-t-10" th:text="#{txt.referencia}"></h4>
		                                            </div>
		
		                                            <div class="col-md-2">
		                                                <div class="align-right">
		                                                    <button class="btn btn-success btn-xs m-10" id="btnAgregarReferencia" type="button">
		                                                        <i class="fas fa-plus"></i>&nbsp; [(#{txt.agregar.referencia})]
		                                                    </button>
		                                                </div>
		                                                <input type="hidden" id="countReferencia" value="0" />
		                                            </div>
		                                        </div>
		                                        
		                                        <div id="contentWrapReferencias">
		                                        	
		                                        	<div th:if="${#strings.equalsIgnoreCase(param.tp, 'NC')}" class="row" id="referencia0">
							                            <div class="col-md-4">
							                                <div class="form-group">
							                                    <label class="control-label">[(#{txt.clave.documento})]</label>
							                                    <input type="text" maxlength="50" id="referenciaClaveDocumento0" th:value="${factura.clave}" placeholder="Digite la clave de la factura original" name="referenciaClaveDocumento[]" class="form-control num-integer" required="required">
							                                </div>
							                            </div>
							                            <div class="col-md-2">
							                                <div class="form-group">
							                                    <label class="control-label">Tipo referencia documento</label>
							                                    <select style="width: 100%" class="form-control _select2_" id="referenciaTipoDoc0" name="referenciaTipoDoc[]" required="required">
							                                        <option value="" selected="selected" th:text="#{txt.combo.seleccione}"></option>
							                                        <option th:each="k : ${listaTipoDocReferencia}" th:attr="selected=${k.id} == ${tipoDocNumerico} ? 'selected' : null" th:value="${k.id}" th:text="${k.documentoReferencia}"></option>
							                                    </select>
							                                </div>
							                            </div>
							                            <div class="col-md-2">
							                                <div class="form-group">
							                                    <label class="control-label">[(#{txt.fecha.de.emision})]</label>
							                                    <div class="input-group">
							                                        <input type="text" id="referenciaFechaDeEmision0" th:value="${fechaEmisionFe}" name="referenciaFechaDeEmision[]" class="form-control align-right dd-mm-yyyy" placeholder="dd/mm/yyyy" required="required">
							                                        <span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
							                                    </div>
							                                </div>
							                            </div>
							                            <div class="col-md-2">
							                                <div class="form-group">
							                                    <label class="control-label">[(#{txt.codigo})] [(${tipoDocNumerico})]</label>
							                                    <select style="width: 100%" class="form-control _select2_" id="referenciaCodigoDocumento0" name="referenciaCodigoDocumento[]" required="required">
							                                        <option value="" selected="selected" th:text="#{txt.combo.seleccione}"></option>
							                                        <option th:each="k : ${listaCodigoReferencia}" th:attr="selected=${k.id} == 2 ? 'selected' : null" th:value="${k.id}" th:text="${k.descripcionReferencia}"></option>
							                                    </select>
							                                </div>
							                            </div>
							                            <div class="col-md-2">
							                                <div class="form-group" style="position: relative;">
							                                    <label class="control-label">[(#{txt.razon})]</label>
							                                    <input type="text" id="referenciaRazonDocumento0" value="ANULAR DOCUMENTO" maxlength="160" placeholder="Digite la razón de referencia" name="referenciaRazonDocumento[]" class="form-control" required="required">
							
							                                    <button class="deleteReferencia btn btn-danger btn-xs" title="Eliminar la referencia" data-id="0" type="button">
							                                        <i class="fa fa-trash" aria-hidden="true"></i>
							                                    </button>
							                                </div>
							                            </div>
							                        </div>
		                                        
		                                        </div>
		                                        
										  </div>
										  <div class="tab-pane fade" id="nav-otros-cargos" role="tabpanel" aria-labelledby="nav-otros-cargos-tab">
										  
										  		<div class="row">
		                                            <div class="col-md-10">
		                                                <h4 class="card-title p-t-10" th:text="#{txt.otros.cargos}"></h4>
		                                            </div>
		
		                                            <div class="col-md-2">
		                                                <div class="align-right">
		                                                    <button class="btn btn-success btn-xs m-10" id="btnAgregarOtrosCargos" type="button">
		                                                        <i class="fas fa-plus"></i>&nbsp; [(#{txt.agregar.otros.cargos})]
		                                                    </button>
		                                                </div>
		                                                <input type="hidden" id="countOtrosCargos" value="0" />
		                                            </div>
		                                        </div>
		
		                                        <div id="contentWrapOtrosCargos">
		                                        
		                                        
		                                        	<div th:each="k : ${factura.itemsOtrosCargos}">
								                        <div class="row" id="otrosCargos{R_ID}" th:id="'otrosCargos' + ${k.id}">
								                            <div class="col-md-2">
								                                <div class="form-group">
								                                    <label class="control-label">[(#{txt.otros.cargos.tipo.documento})]</label>
								                                    <select style="width: 100%" class="form-control comboOtrosCargosTipoDoc _select2_" data-id="{R_ID}" th:attr="data-id=${k.id}" th:id="'otrosCargosTipoDoc' + ${k.id}" id="otrosCargosTipoDoc{R_ID}" name="otrosCargosTipoDoc[]" required="required">
								                                        <option value="" selected="selected" th:text="#{txt.combo.seleccione}"></option>
								                                        <option th:attr="selected=${#strings.equals(k.tipoDocumento, #strings.toString(j.id)) ? 'selected' : null}" th:each="j : ${listaTipoDocOtrosCargos}" th:value="${j.id}" th:text="${j.tipoDocumento}"></option>
								                                    </select>
								                                </div>
								                            </div>
								                            <div class="col-md-2">
								                                <div class="form-group">
								                                    <label class="control-label">[(#{txt.otros.cargos.identificacion})]</label>
								                                    <input type="text" th:value="${k.numeroIdentidadTercero}" readonly="readonly" id="otrosCargosIdentificacion{R_ID}" th:id="'otrosCargosIdentificacion' + ${k.id}" name="otrosCargosIdentificacion[]" maxlength="12" class="form-control">
								                                </div>
								                            </div>
								                            <div class="col-md-2">
								                                <div class="form-group">
								                                    <label class="control-label">[(#{txt.otros.cargos.nombre})]</label>
								                                    <input type="text" th:value="${k.nombreTercero}" readonly="readonly" id="otrosCargosNombre{R_ID}" th:id="'otrosCargosNombre' + ${k.id}" name="otrosCargosNombre[]" class="form-control">
								                                </div>
								                            </div>
								                            <div class="col-md-3">
								                                <div class="form-group">
								                                    <label class="control-label">[(#{txt.otros.cargos.detalle})]</label>
								                                    <input type="text" id="otrosCargosDetalle{R_ID}" th:id="'otrosCargosDetalle' + ${k.id}" th:value="${k.detalle}" maxlength="160" placeholder="Digite el detalle" name="otrosCargosDetalle[]" class="form-control" required="required">
								                                </div>
								                            </div>
								                            <div class="col-md-1">
								                                <div class="form-group">
								                                    <label class="control-label">[(#{txt.otros.cargos.porcentaje})]</label>
								                                    <input type="text" id="otrosCargosPorcentaje{R_ID}" th:id="'otrosCargosPorcentaje' + ${k.id}" th:attr="data-id=${k.id}"  th:value="${k.porcentaje}" maxlength="3" placeholder="" name="otrosCargosPorcentaje[]" class="porcentajeOtrosCargos form-control num-integer">
								                                </div>
								                            </div>
								                            <div class="col-md-2">
								                                <div class="form-group" style="position:relative">
								                                    <label class="control-label">[(#{txt.otros.cargos.monto})]</label>
								                                    <input type="text" id="otrosCargosMontoCargo{R_ID}" th:id="'otrosCargosMontoCargo' + ${k.id}"  th:value="${k.montoCargo}" onkeypress="return validateFloatKeyPress(this,event);" maxlength="20" placeholder="Monto total del cargo" name="otrosCargosMonto[]" class="form-control inputOtrosCargos" required="required">
								
								                                    <button class="deleteOtrosCargos btn btn-danger btn-xs" title="Eliminar linea" th:attr="data-id=${k.id}" data-id="{R_ID}" type="button">
								                                        <i class="fa fa-trash" aria-hidden="true"></i>
								                                    </button>
								
								                                </div>
								                            </div>
								                        </div>
								                    </div>
		                                        
		                                        
		                                        </div>
										  
										  </div>
										</div>

                                        <div class="row">
                                            <div class="col-md-8" style="display:none;">
                                                <h4 class="card-title p-t-10" th:text="#{txt.resumen.de.la.factura}"></h4>
                                                <hr class="linea-horizontal">

                                                <input readonly="readonly" type="hidden" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalServGravados}" name="totalServiciosGravados" id="totalServiciosGravados">
                                                <input readonly="readonly" type="hidden" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalServExentos}" name="totalServiciosExentos" id="totalServiciosExentos">
                                                <input readonly="readonly" type="hidden" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalServExonerado}" name="totalServiciosExonerado" id="totalServiciosExonerado">
                                                <input readonly="readonly" type="hidden" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalMercGravadas}" name="totalMercanciaGravadas" id="totalMercanciaGravadas">
                                                <input readonly="readonly" type="hidden" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalMercExentas}" name="totalMercanciasExentas" id="totalMercanciasExentas">
                                                <input readonly="readonly" type="hidden" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalMercExonerada}" name="totalMercanciasExonerada" id="totalMercanciasExonerada">

                                                <div class="row">

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.gravados}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalGravados}" name="totalGravados" id="totalGravados">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.exentos}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalExentos}" name="totalExentos" id="totalExentos">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.exonerado}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalExonerado}" name="totalExonerado" id="totalExonerado">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.venta}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalVentas}" name="totalVenta" id="totalVenta">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.descuentos}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalDescuentos}" name="descuentos" id="descuentos">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.venta.neta}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalVentaNeta}" name="totalVentaNeta" id="totalVentaNeta">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.impuestos}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalImp}" name="totalImpuestos" id="totalImpuestos">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.iva.devuelto}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalIVADevuelto}" name="totalIVADevuelto" id="totalIVADevuelto">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.otros.cargos}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalOtrosCargos}" name="totalOtrosCargos" id="totalOtrosCargos">
                                                            </div>
                                                        </div>

                                                        <div class="form-group sumary-factura">
                                                            <label style="border-top:2px solid gray; width: 100%;" class="control-label p-t-10" th:text="#{txt.total.comprobante}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" th:value="${factura.totalComprobante}" name="totalFactura" id="totalFactura">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-actions emitir-factura ">
                                            <input id="csrfToken" type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                                            <div class="modal fade" id="modalPagar" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">

                                                            <h4 class="documentoAGenerar modal-title" style="margin-bottom:0 !important">Se va a generar un(a) <span id="documentoAGenerar"></span></h4>

                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body">

                                                            <div class="row">

                                             
                                             <div class="col-md-6" th:style="${#strings.equalsIgnoreCase(param.tp, 'NC') ? 'display:none' : 'display:block'}">
                                              <div class="form-group">
	                                                  <label class="control-label" th:text="#{txt.condicion.de.venta}"></label>
	                                                  <select th:if="!${#strings.equalsIgnoreCase(param.tp, 'NC')}" style="width: 100%" class="form-control" id="condVenta" th:field="*{condVenta}" required="required">
	                                                      <option th:each="k : ${listaCondicionDeVenta}" th:value="${k.id}" th:text="${k.condicionVenta}"></option>
	                                                  </select>
	                                                  <input type="text" th:field="*{condVenta}" />
	                                              </div>
	                                          </div>
                                             
                                             <div class="col-md-6" th:style="${#strings.equalsIgnoreCase(param.tp, 'NC') ? 'display:none' : 'display:block'}">
                                                  <div class="form-group">
	                                                  <label class="control-label" th:text="#{txt.plazo.de.credito}"></label>
	                                                  <input readonly="readonly" id="plazoCredito" name="plazoCredito" onclick="return this.select();" th:value="${factura.cliente} != null and ${factura.condVenta} == 2 ? ${factura.plazoCredito}" type="number" class="form-control">
	                                                  <span style="display: none;" id="notificacionPlazoCredito"></span>
	                                              </div>
                                             </div>
                                             <div th:if="${session.SESSION_APLICA_DEVOLUCION_IVA == 'S'}" class="col-md-12 m-t-10">
	                                            <div class="form-check">
												  <input class="form-check-input" type="checkbox" onchange="devolucionIva()" id="aplicarDevolucionIva">
												  <label class="form-check-label" for="aplicarDevolucionIva">
												    Aplicar devolución del IVA
												  </label>
												</div> 
	                                        </div>
                                             <div class="col-md-6 ivaDevuelto"  style="display: none;" th:style="${#strings.equalsIgnoreCase(param.tp, 'NC') ? 'display:none' : 'display:block'}">
                                                <div class="form-group sumary-factura">
                                                   <label class="control-label" style="text-align: left; width: 100%;">IVA devuelto</label>
                                                   <div class="input-group"> 
                                                      <span class="input-group-addon simbolo-moneda"></span>
                                                      <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format-final" value="0.00" id="ivaDevuelto">
                                                   </div>
                                                </div>
                                             </div>
                                             <div th:if="${param.tp == null}" class="col-md-6">
                                                <div class="form-group sumary-factura">
                                                   <label class="control-label" style="text-align: left; width: 100%;">[(#{txt.total.a.pagar})]</label>
                                                   <div class="input-group"> 
                                                      <span class="input-group-addon simbolo-moneda"></span>
                                                      <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format-final" value="0.00" id="totalAPagar" th:value="${factura.totalComprobante}">
                                                      
                                                      
                                                   </div>
                                                </div>
                                             </div>
                                             
                                             <input readonly="readonly" type="hidden" value="0.00" th:if="${#strings.equalsIgnoreCase(param.tp, 'NC')}" name="medioPago1" th:attr="name='medioPago' + ${factura.medioPago}" th:id="'medioPago' + ${factura.medioPago}" class="totalAPagarNc" th:value="${factura.totalComprobante}">
                                             
                                             <div th:if="${param.tp == null}" class="col-md-12 condicion-venta">
                                             	<p class="bg-warning font-weight-bold" style="color:#000000; margin-bottom:5px !important; padding:4px !important;">Digite el monto del dinero recibido para calcular el vuelto.</p>

                                             </div>

                                                                <div th:if="${param.tp == null}" class="col-md-12 condicion-venta">

                                                                    <ul class="nav nav-tabs customtab" role="tablist">
                                                                        <li class="nav-item"><a class="nav-link pago-colones" th:classappend="${MONEDA_USUARIO} == 1 ? active : ''" data-toggle="tab" href="#colones" role="tab" aria-selected="false"><span class="hidden-sm-up"><i class="ti-home"></i></span> <span class="hidden-xs-down">¢ Colones</span></a></li>
                                                                        <li class="nav-item"><a class="nav-link pago-dolares" th:classappend="${MONEDA_USUARIO} == 2 ? active : ''" data-toggle="tab" href="#dolares" role="tab" aria-selected="false"><span class="hidden-sm-up"><i class="ti-user"></i></span> <span class="hidden-xs-down">$ Dolares</span></a> </li>
                                                                        <li class="nav-item"><a class="nav-link pago-euros" th:classappend="${MONEDA_USUARIO} == 3 ? active : ''" data-toggle="tab" href="#euros" role="tab" aria-selected="true"><span class="hidden-sm-up"><i class="ti-email"></i></span> <span class="hidden-xs-down">€ Euros</span></a> </li>
                                                                    </ul>

                                                                    <div class="tab-content">
                                                                        <div class="tab-pane pago-colones" th:classappend="${MONEDA_USUARIO} == 1 ? active : ''" id="colones" role="tabpanel">
                                                                            <div class="row m-t-10">
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'¢ Efectivo'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPago1" id="medioPago1" onclick="return this.select();" class="form-control medioPago align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'¢ Tarjeta'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPago2" id="medioPago2" onclick="return this.select();" class="form-control medioPago align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'¢ Cheque'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPago3" id="medioPago3" onclick="return this.select();" class="form-control medioPago align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'¢ Transferencia - depósito bancario'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPago4" id="medioPago4" onclick="return this.select();" class="form-control medioPago align-right" value="0">
                                                                                    </div>
                                                                                </div>

                                                                                <div style="display:none" class="col-md-6 medio-pago-tarjeta">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="#{txt.ultimos.4.digitos.tarjeta}"></label>
                                                                                        <input name="numeroTarjeta" maxlength="4" onclick="return this.select();" type="text" class="input-medio-pago-tarjeta form-control num-integer">
                                                                                    </div>
                                                                                </div>
                                                                                <div style="display:none" class="col-md-6 medio-pago-tarjeta">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="#{txt.numero.autorizacion}"></label>
                                                                                        <input name="numeroAutorizacion" maxlength="50" onclick="return this.select();" type="text" class="input-medio-pago-tarjeta form-control ">
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="tab-pane pago-dolares" id="dolares" th:classappend="${MONEDA_USUARIO} == 2 ? active : ''" role="tabpanel">
                                                                            <div class="row m-t-10">
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'$ Efectivo'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoDolar1" id="medioPagoDolar1" onclick="return this.select();" class="form-control medioPagoDolar align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'$ Tarjeta'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoDolar2" id="medioPagoDolar2" onclick="return this.select();" class="form-control medioPagoDolar align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'$ Cheque'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoDolar3" id="medioPagoDolar3" onclick="return this.select();" class="form-control medioPagoDolar align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'$ Transferencia - depósito bancario'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoDolar4" id="medioPagoDolar4" onclick="return this.select();" class="form-control medioPagoDolar align-right" value="0">
                                                                                    </div>
                                                                                </div>

                                                                                <div style="display:none" class="col-md-6 medio-pago-tarjeta-dolar">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="#{txt.ultimos.4.digitos.tarjeta}"></label>
                                                                                        <input name="numeroTarjetaDolar" maxlength="4" onclick="return this.select();" type="text" class="input-medio-pago-tarjeta-dolar form-control num-integer">
                                                                                    </div>
                                                                                </div>
                                                                                <div style="display:none" class="col-md-6 medio-pago-tarjeta-dolar">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="#{txt.numero.autorizacion}"></label>
                                                                                        <input name="numeroAutorizacionDolar" maxlength="50" onclick="return this.select();" type="text" class="input-medio-pago-tarjeta-dolar form-control ">
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="tab-pane pago-euros" th:classappend="${MONEDA_USUARIO} == 3 ? active : ''" id="euros" role="tabpanel">

                                                                            <div class="row m-t-10">
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'€ Efectivo'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoEuro1" id="medioPagoEuro1" onclick="return this.select();" class="form-control medioPagoEuro align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'€ Tarjeta'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoEuro2" id="medioPagoEuro2" onclick="return this.select();" class="form-control medioPagoEuro align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'€ Cheque'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoEuro3" id="medioPagoEuro3" onclick="return this.select();" class="form-control medioPagoEuro align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'€ Transferencia - depósito bancario'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoEuro4" id="medioPagoEuro4" onclick="return this.select();" class="form-control medioPagoEuro align-right" value="0">
                                                                                    </div>
                                                                                </div>

                                                                                <div style="display:none" class="col-md-6 medio-pago-tarjeta-euro">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="#{txt.ultimos.4.digitos.tarjeta}"></label>
                                                                                        <input name="numeroTarjetaEuro" maxlength="4" onclick="return this.select();" type="text" class="input-medio-pago-tarjeta-euro form-control num-integer">
                                                                                    </div>
                                                                                </div>
                                                                                <div style="display:none" class="col-md-6 medio-pago-tarjeta-euro">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="#{txt.numero.autorizacion}"></label>
                                                                                        <input name="numeroAutorizacionEuro" maxlength="50" onclick="return this.select();" type="text" class="input-medio-pago-tarjeta-euro form-control ">
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>

                                                            <!-- 
			                                 <div class="col-md-12">

		                                          <div class="form-group sumary-factura">
		                                            <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.pago.con})]</label>
		                                            <div class="input-group"> 
        									 			<span class="input-group-addon simbolo-moneda"></span>
		                                             	<input type="text" onkeypress="return validateFloatKeyPress(this,event);" class="form-control align-right number-format-final resumen-factura" onclick="return this.select();" name="pagoCon" value="0.00" style="background-color: #FFF !important;color:gray !important" id="pagoCon" required="required">
		                                          	</div>
		                                          </div>
		                                       </div>
		                                        -->
                                                            <hr th:if="${param.tp == null}" class="condicion-venta">
                                                            <div th:if="${param.tp == null}" class="row condicion-venta">

                                                                <div class="col-6 col-md-4">
                                                                    <div class="form-group">
                                                                        <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.su.vuelto})]: colones</label>
                                                                        <div class="input-group">
                                                                            <span class="input-group-addon">¢</span>
                                                                            <input readonly="readonly" type="text" name="suVuelto" class="form-control align-right resumen-factura number-format-final suVuelto" value="0" autofocus>

                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-6 col-md-4">
                                                                    <div class="form-group">
                                                                        <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.su.vuelto})]: dolares</label>
                                                                        <div class="input-group">
                                                                            <span class="input-group-addon">$</span>
                                                                            <input readonly="readonly" type="text" name="suVueltoDolar" class="form-control align-right resumen-factura number-format-final suVueltoDolar" value="0" autofocus>

                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-12 col-md-4">
                                                                    <div class="form-group">
                                                                        <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.su.vuelto})]: euros</label>
                                                                        <div class="input-group">
                                                                            <span class="input-group-addon">€</span>
                                                                            <input readonly="readonly" type="text" name="suVueltoEuro" class="form-control align-right resumen-factura number-format-final suVueltoEuro" value="0" autofocus>

                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>

                                                        </div>
                                                        <div class="modal-footer">

                                                            <div class="row">
                                                            	<div class="col-12 col-md-4 m-t-10">
                                                            		<button type="button" class="btn btn-inverse btn-block btn-lg m-10" data-dismiss="modal">
	                                                                    <i class="fa fa-ban" aria-hidden="true"></i>&nbsp; <span th:text="#{btn.cancelar}"></span>
	                                                                </button>
                                                            	</div>
                                                            	<div th:if="${param.tp == null}" class="col-12 col-md-8 m-t-10">
                                                            		<button id="btnEmitirFactura" type="submit" class="btn btn-success btn-block btn-lg m-10">
	                                                                    <i class="fa fa-shopping-cart" aria-hidden="true"></i>&nbsp;F10 - <span th:text="#{btn.emitir.factura}"></span>
	                                                                </button>
                                                            	</div>
                                                            	<div th:if="${#strings.equalsIgnoreCase(param.tp, 'NC')}" class="col-12 col-md-8 m-t-10">
                                                            		<button id="btnEmitirFactura" type="submit" class="btn btn-success btn-block btn-lg m-10">
	                                                                    <i class="fa fa-shopping-cart" aria-hidden="true"></i>&nbsp;F10 - <span>Aplicar Nota de crédito</span>
	                                                                </button>
                                                            	</div>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="modal fade" id="modalFinVenta" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true">
                                                <div>
                                                    <div class="modal-dialog" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title"><strong>Venta finalizada</strong></h5>
                                                                <button type="button" class="close reload-page" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">

                                                                <div class="row">

                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.su.vuelto})]: colones</label>
                                                                            <div class="input-group">
                                                                                <span class="input-group-addon">¢</span>
                                                                                <input readonly="readonly" type="text" name="suVuelto" class="form-control align-right resumen-factura number-format-final suVuelto" value="0" autofocus>

                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.su.vuelto})]: dolares</label>
                                                                            <div class="input-group">
                                                                                <span class="input-group-addon">$</span>
                                                                                <input readonly="readonly" type="text" name="suVueltoDolar" class="form-control align-right resumen-factura number-format-final suVueltoDolar" value="0" autofocus>

                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.su.vuelto})]: euros</label>
                                                                            <div class="input-group">
                                                                                <span class="input-group-addon">€</span>
                                                                                <input readonly="readonly" type="text" name="suVueltoEuro" class="form-control align-right resumen-factura number-format-final suVueltoEuro" value="0" autofocus>

                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <div class="col-md-12">
                                                                        <div class="form-group">
                                                                            <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.clave})]</label>
                                                                            <input id="responseClave" readonly="readonly" type="text" class="form-control align-right">
                                                                        </div>
                                                                    </div>

                                                                    <div class="col-md-12">
                                                                        <div class="form-group">
                                                                            <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.consecutivo})]</label>
                                                                            <input id="responseConsecutivo" readonly="readonly" type="text" class="form-control align-right">
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                            <div class="modal-footer ">

                                                                <div class="align-center">

                                                                    <a class="btn btn-info btn-lg m-b-10 btn-block" id="btnNuevaFacturacion" th:href="@{/proformas/}" style="color:#FFF !important">
															        	F5 - <i class="fas fa-file-invoice"></i>&nbsp; <span th:text="#{btn.seguir.facturando}"></span>
															        </a>

                                                                    <button data-print="C" class="btn-imprimir-factura btn btn-success btn-lg m-10">
                                                                        <i class="fas fa-print"></i>&nbsp;<span>Imprimir carta</span>
                                                                    </button>

                                                                    <button data-print="T" class="btn-imprimir-factura btn btn-primary btn-lg m-10">
                                                                        <i class="fas fa-print"></i>&nbsp;<span>Imprimir tiquete</span>
                                                                    </button>

                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                        <div class="cajaTablaTotal">

                                            <div class="row">
                                                <div class="col-md-1"></div>
                                                <div  class="col-md-1">
                                                    <a th:href="@{/facturar/}" class="btn-movil btn btn-outline-warning m-t-10" style="color:#FFF !important; margin-top:15px !important">
                                                        <i class="fas fa-broom"></i>&nbsp; F5
                                                    </a>
                                                </div>

                                                <div class="col-md-2">
                                                    <button th:if="${param.tp == null}" style="margin-top:19px !important" title="Guarda el documento como una proforma" data-toggle="tooltip" data-placement="top" id="btnGuardarProforma" type="button" class="btn-movil btn btn-block btn-outline-secondary m-t-10">
                                                        <i class="fas fa-save"></i>&nbsp;Guardar proforma
                                                    </button>
                                                </div>

                                                <div th:if="${param.tp == null}" class="col-md-2">
                                                    <button style="margin-top:19px !important" id="btnModalPagar" type="button" class="btn-movil btn btn-block btn-outline-secondary m-t-10">
                                                        <i class="fas fa-money-check"></i>&nbsp;F9 - Cobrar
                                                    </button>
                                                </div>
                                                <div th:if="${#strings.equalsIgnoreCase(param.tp, 'NC')}" class="col-md-2">
                                                    <button style="margin-top:19px !important" id="btnModalPagar" type="button" class="btn-movil btn btn-block btn-outline-secondary m-t-10">
                                                        <i class="fas fa-money-check"></i>&nbsp;F9 - Continuar NC
                                                    </button>
                                                </div>

                                                <div class="col-md-2">
                                                    <div class="form-group sumary-factura">
                                                        <label class="control-label" th:text="#{txt.total.venta}"></label>
                                                        <div class="input-group">
                                                            <span class="input-group-addon simbolo-moneda"></span>
                                                            <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" th:value="${factura.totalVentaNeta}" value="0" id="totalVentaSumary">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group sumary-factura">
                                                        <label class="control-label" th:text="#{txt.total.impuestos}"></label>
                                                        <div class="input-group">
                                                            <span class="input-group-addon simbolo-moneda"></span>
                                                            <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" th:value="${factura.totalImp}" value="0" id="totalImpuestosSumary">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group sumary-factura">
                                                        <label class="control-label" th:text="#{txt.total.comprobante}"></label>
                                                        <div class="input-group">
                                                            <span class="input-group-addon simbolo-moneda"></span>
                                                            <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" th:value="${factura.totalComprobante}" value="0" id="totalFacturaSumary">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>

                                </form>

                                </div>
                            </div>
                        </div>
                        <!-- ============================================================== -->
                        <!-- End PAge Content -->
                        <!-- ============================================================== -->
                    </div>

                    <input type="hidden" value="" id="inputImprimirFactura">

                    <iframe style="width:100%; height:1px; display:none" id="IframeImprimirFactura" frameBorder="0" allowfullscreen></iframe>

                    <table th:replace="facturacion/plantilla-items_avanzado :: itemsFactura"></table>

                    <div id="itemsOtrosCargos" class="d-none">
                        <div class="row" id="otrosCargos{R_ID}">
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.otros.cargos.tipo.documento})]</label>
                                    <select style="width: 100%" class="form-control comboOtrosCargosTipoDoc" data-id="{R_ID}" id="otrosCargosTipoDoc{R_ID}" name="otrosCargosTipoDoc[]" required="required">
                                        <option value="" selected="selected" th:text="#{txt.combo.seleccione}"></option>
                                        <option th:each="k : ${listaTipoDocOtrosCargos}" th:value="${k.id}" th:text="${k.tipoDocumento}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.otros.cargos.identificacion})]</label>
                                    <input type="text" readonly="readonly" id="otrosCargosIdentificacion{R_ID}" name="otrosCargosIdentificacion[]" maxlength="12" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.otros.cargos.nombre})]</label>
                                    <input type="text" readonly="readonly" id="otrosCargosNombre{R_ID}" name="otrosCargosNombre[]" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.otros.cargos.detalle})]</label>
                                    <input type="text" id="otrosCargosDetalle{R_ID}" maxlength="160" placeholder="Digite el detalle" name="otrosCargosDetalle[]" class="form-control" required="required">
                                </div>
                            </div>
                            <div class="col-md-1">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.otros.cargos.porcentaje})]</label>
                                    <input type="text" id="otrosCargosPorcentaje{R_ID}" data-id="{R_ID}" maxlength="3" placeholder="" name="otrosCargosPorcentaje[]" class="porcentajeOtrosCargos form-control num-integer">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group" style="position:relative">
                                    <label class="control-label">[(#{txt.otros.cargos.monto})]</label>
                                    <input type="text" id="otrosCargosMontoCargo{R_ID}" onkeypress="return validateFloatKeyPress(this,event);" maxlength="20" placeholder="Monto total del cargo" name="otrosCargosMonto[]" class="form-control inputOtrosCargos" required="required">

                                    <button class="deleteOtrosCargos btn btn-danger btn-xs" title="Eliminar linea" data-id="{R_ID}" type="button">
                                        <i class="fa fa-trash" aria-hidden="true"></i>
                                    </button>

                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="itemsReferencia" class="d-none">
                        <div class="row" id="referencia{R_ID}">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.clave.documento})]</label>
                                    <input type="text" maxlength="50" id="referenciaClaveDocumento{R_ID}" placeholder="Digite la clave de la factura original" name="referenciaClaveDocumento[]" class="form-control num-integer" required="required">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="control-label">Tipo referencia documento</label>
                                    <select style="width: 100%" class="form-control" id="referenciaTipoDoc{R_ID}" name="referenciaTipoDoc[]" required="required">
                                        <option value="" selected="selected" th:text="#{txt.combo.seleccione}"></option>
                                        <option th:each="k : ${listaTipoDocReferencia}" th:value="${k.id}" th:text="${k.documentoReferencia}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.fecha.de.emision})]</label>
                                    <div class="input-group">
                                        <input type="text" id="referenciaFechaDeEmision{R_ID}" name="referenciaFechaDeEmision[]" class="form-control align-right dd-mm-yyyy" placeholder="dd/mm/yyyy" required="required">
                                        <span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.codigo})]</label>
                                    <select style="width: 100%" class="form-control" id="referenciaCodigoDocumento{R_ID}" name="referenciaCodigoDocumento[]" required="required">
                                        <option value="" selected="selected" th:text="#{txt.combo.seleccione}"></option>
                                        <option th:each="k : ${listaCodigoReferencia}" th:value="${k.id}" th:text="${k.descripcionReferencia}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group" style="position: relative;">
                                    <label class="control-label">[(#{txt.razon})]</label>
                                    <input type="text" id="referenciaRazonDocumento{R_ID}" maxlength="160" placeholder="Digite la razón de referencia" name="referenciaRazonDocumento[]" class="form-control" required="required">

                                    <button class="deleteReferencia btn btn-danger btn-xs" title="Eliminar la referencia" data-id="{R_ID}" type="button">
                                        <i class="fa fa-trash" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div data-backdrop="static" data-keyboard="false" class="modal fade" id="ModalNuevoCliente" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                            <form id="formAddCliente" autocomplete="off" th:action="@{/clientes/form/save}" th:object="${cliente}" method="post">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">[(#{txt.registrar.cliente})]</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">

                                        <div class="form-body">

                                            <hr>
                                            <div style="margin: 0 !important" class="row p-t-20 card-body-facturador">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Buscar cliente por número de identificación</label>
                                                        <input onclick="return this.select();" type="text" placeholder="Digite la identificación" id="buscarClienteApi" maxlength="20" class="form-control num-integer">
                                                    </div>
                                                </div>
                                            </div>

                                            <hr>

                                            <div class="row">
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.tipo.identificacion})]</label>
                                                        <select class="form-control _select2_ width100" th:field="*{tipoDeIdentificacion}" required="required">
                                                            <option value="" selected="selected" th:text="#{txt.combo.seleccione}"></option>
                                                            <option th:each="k : ${listaTipoDeIdentificacion}" th:value="${k.id}" th:text="${k.tipoDeIdentificacion}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.identificacion})]</label>

                                                        <input th:if="${cliente.tipoDeIdentificacion == null}" type="text" th:attr="maxlength=9" class="form-control num-integer" th:field="*{identificacion}" required="required">

                                                    </div>
                                                </div>
                                                <div class="col-sm-8 col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.nombre.completo})]</label>
                                                        <input type="text" maxlength="80" class="form-control" th:field="*{nombreCompleto}" required="required">
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.codigo.pais}"></label>
                                                        <input type="text" maxlength="3" class="form-control num-integer" value="506" th:field="*{codigoPais}">
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.telefono1}"></label>
                                                        <input th:attr="maxlength=${cliente.tipoDeIdentificacion != null && cliente.tipoDeIdentificacion.id > 2 ?  20 : 8}" type="text" class="form-control num-integer" th:field="*{telefono1}">
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.telefono2}"></label>
                                                        <input type="text" th:attr="maxlength=${cliente.tipoDeIdentificacion != null && cliente.tipoDeIdentificacion.id > 2 ?  20 : 8}" class="form-control num-integer" th:field="*{telefono2}">
                                                    </div>
                                                </div>

                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.fax}"></label>
                                                        <input th:attr="maxlength=${cliente.tipoDeIdentificacion != null && cliente.tipoDeIdentificacion.id > 2 ?  20 : 8}" type="text" maxlength="8" class="form-control" th:field="*{fax}">
                                                    </div>
                                                </div>

                                                <div class="col-sm-8 col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.correo1})]</label>
                                                        <input type="email" maxlength="150" class="form-control" th:field="*{correo1}" required="required">
                                                    </div>
                                                </div>

                                                <div class="col-sm-8 col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.correo2}"></label>
                                                        <input type="email" maxlength="150" class="form-control" th:field="*{correo2}">
                                                    </div>
                                                </div>

                                            </div>

                                            <hr class="linea-horizontal">

                                            <h5 th:text="#{txt.datos.ubicacion.opcionales}"></h5>

                                            <div class="row">

                                                <div class="col-sm-6 col-md-3">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.provincia}"></label>
                                                        <select class="form-control _select2_ width100" th:field="*{provincia}">
                                                            <option th:value="''" selected="selected" th:text="#{txt.combo.seleccione}"></option>
                                                            <option th:each="k : ${listaProvincias}" th:value="${k.id}" th:text="${k.provincia}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 col-md-3">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.canton}"></label>
                                                        <select class="form-control _select2_ width100" th:field="*{canton}">
                                                            <option th:each="k : ${listaCantones}" th:value="${k.id}" th:text="${k.canton}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 col-md-3">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.distrito}"></label>
                                                        <select class="form-control _select2_ width100" id="distrito" th:field="*{distrito}">
                                                            <option th:each="k : ${listaDistritos}" th:value="${k.id}" th:text="${k.distrito}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 col-md-3">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.barrio}"></label>
                                                        <select class="form-control _select2_ width100" id="barrio" th:field="*{barrio}">
                                                            <option th:each="k : ${listaBarrios}" th:value="${k.id}" th:text="${k.barrio}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.direccion}"></label>
                                                        <input type="text" class="form-control" maxlength="255" th:field="*{otrasSenas}">
                                                    </div>
                                                </div>

                                            </div>

                                        </div>

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-inverse" data-dismiss="modal">
                                            <i class="fa fa-ban" aria-hidden="true"></i> [(#{btn.cancelar})]
                                        </button>
                                        <input type="hidden" class="form-control" value="" id="formGuardar" th:field="*{id}">
                                        <button type="submit" class="btn btn-success">
                                            <i class="fas fa-save"></i>&nbsp;<span th:text="#{btn.guardar}"></span>
                                        </button>
                                    </div>
                            </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal fade modalImpuestos" tabindex="-1" role="dialog">
					  <div class="modal-dialog" role="document">
					    <div class="modal-content">
					      <div class="modal-header">
					        <h5 class="modal-title" id="exampleModalLongTitle">Modificar impuesto</h5>
					        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
					          <span aria-hidden="true">&times;</span>
					        </button>
					      </div>
					      <div class="modal-body">
					        <div class="row">
					        	<div class="col-md-12">
		                            <div class="form-group">
		                               <label class="control-label">Impuesto</label>
		                               <select id="tipoImpuesto" class="form-control">
		                               		<option th:each="k : ${listaImpuestos}" th:attr="data-di=${k.detalleImpuesto}" th:value="${k.id}">[(${k.detalleImpuesto})]</option>
		                               </select>
		                            </div>
		                         </div>
		                         <div class="col-md-12">
		                            <div class="form-group">
		                               <label class="control-label">Tarifa impuesto IVA</label>
		                               <select id="tarifaImpuesto" class="form-control">
		                               		<option th:each="k : ${listaCodigosTarifasIva}" th:attr="data-tarifa=${k.tarifa}" th:value="${k.id}">[(${k.detalleTarifaImpuestoIva})]</option>
		                               </select>
		                            </div>
		                         </div>
					        </div>
					      </div>
					      <div class="modal-footer">
					        <button type="button" class="btn btn-inverse" data-dismiss="modal"><i class="fas fa-window-close"></i> Cerrar</button>					        
					        <input type="hidden" id="_productoId">
					        <input type="hidden" id="_impuestoId">
					        <input type="hidden" id="_tarifaImpuestoId">
					        <button type="button" id="btnAplicarImpuesto" class="btn btn-success"><i class="fas fa-save"></i> Aplicar</button>
					      </div>
					    </div>
					  </div>
					</div>

                    <!-- ============================================================== -->
                    <!-- End Container fluid  -->
                    <!-- ============================================================== -->
                    <!-- ============================================================== -->
                    <!-- footer -->
                    <!-- ============================================================== -->
                    <footer th:replace="layout/layout :: footer"></footer>
                    <!-- ============================================================== -->
                    <!-- End footer -->
                    <!-- ============================================================== -->
                    <input id="csrfToken" type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                </div>
                <!-- ============================================================== -->
                <!-- End Page wrapper  -->
                <!-- ============================================================== -->
            </div>

            <div th:replace="layout/layout :: scripts"></div>
            <div th:replace="facturacion/scriptFacturador :: scriptFacturacionFracmento"></div>

</body>

</html>