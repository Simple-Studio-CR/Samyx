<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
   <head th:replace="layout/layout :: head"></head>
   <body class="fix-header card-no-border logo-center">
      <div id="main-wrapper">
         <header th:replace="layout/layout :: header"></header>
         <aside th:replace="layout/layout :: aside"></aside>
         <!-- ============================================================== -->
         <!-- Page wrapper  -->
         <!-- ============================================================== -->
         <div class="page-wrapper">
            <!-- ============================================================== -->
            <!-- Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <div class="row page-titles">
               <div class="col-md-5 align-self-center">
                  <h3 class="text-themecolor" th:text="#{txt.datos.de.la.empresa}"></h3>
               </div>
               <div class="col-md-7 align-self-center">
                  <ol class="breadcrumb">
                     <li class="breadcrumb-item">
                        <a href="javascript:void(0)" th:href="@{/emisor/}" th:text="#{txt.inicio}"></a>
                     </li>
                     <li class="breadcrumb-item active" th:text="#{txt.datos.de.la.empresa}"></li>
                  </ol>
               </div>
            </div>
            <!-- ============================================================== -->
            <!-- End Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- Container fluid  -->
            <!-- ============================================================== -->
            <div class="container-fluid">
               <!-- ============================================================== -->
               <!-- Start Page Content -->
               <!-- ============================================================== -->
               <div class="row">
                  <div class="col-12">
                     <div class="card">
                        <div class="card-body">
   
                           <div th:if="${response} == 2" class="alert alert-warning alert-dismissible fade show" role="alert">
							  <i class="fas fa-exclamation-triangle"></i> Existe otra empresa con la misma identificación o con el mismo correo, debe cambiarlos para poder continuar.
							  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
							    <span aria-hidden="true">&times;</span>
							  </button>
						   </div>                           
							                           
                           <form id="formEmpresa" enctype="multipart/form-data" autocomplete="off" th:action="@{/emisor/registrar-empresa/}" th:object="${emisor}" method="post">
                              <div class="form-body">
                                 <!-- Nav tabs -->
                                 <ul class="nav nav-tabs">
                                    <li class="nav-item">
                                       <a class="nav-link active" data-toggle="tab" href="#datos-emisor">Datos del Emisor</a>
                                    </li>
                                 </ul>
                                 <!-- Tab panes -->
                                 <div class="tab-content">
                                    <div id="datos-emisor" class="tab-pane active m-t-10">

                                       <h3 class="title-border-bottom" th:text="#{txt.datos.de.la.empresa}"></h3>
                                       <div class="row p-t-20">
                                       
                                       	  <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> Código actividad</label>
                                                <input type="text" maxlength="6" class="form-control" th:field="*{codigoActividad}" required="required">
                                             </div>
                                          </div>
                                       
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.tipo.identificacion})]</label>
                                                <select class="form-control _select2_" th:field="*{tipoDeIdentificacion}" required="required">
                                                   <option th:value="''" th:text="#{txt.combo.seleccione}"></option>
                                                   <option th:value="'1'" th:text="#{txt.cedula.fisica}"></option>
                                                   <option th:value="'2'" th:text="#{txt.cedula.juridica}"></option>
                                                   <option th:value="'3'" th:text="#{txt.dimex}"></option>
                                                   <option th:value="'4'" th:text="#{txt.nite}"></option>
                                                </select>
                                             </div>
                                          </div>
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.identificacion})]</label>
                                                <input type="text" class="form-control num-integer" th:field="*{identificacion}" required="required">
                                             </div>
                                          </div>
                                          <div class="col-md-4">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.nombre.razon.social})]</label>
                                                <input type="text" maxlength="100" class="form-control" th:field="*{nombreRazonSocial}" required="required">
                                             </div>
                                          </div>
                                          <div class="col-md-4">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.nombre.comercial})]</label>
                                                <input type="text" maxlength="80" class="form-control" th:field="*{nombreComercial}" required="required">
                                             </div>
                                          </div>
                                          <div class="col-md-4">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.email})]</label>
                                                <input type="text" class="form-control" th:field="*{email}" required="required">
                                             </div>
                                          </div>
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label">[(#{txt.codigo.pais})]</label>
                                                <input type="text" class="form-control num-integer" maxlength="3" name="codigoPais" value="506" required="required" readonly="readonly">
                                             </div>
                                          </div>
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.telefono})]</label>
                                                <input type="text" class="form-control num-integer" maxlength="8" th:field="*{telefono}" required="required">
                                             </div>
                                          </div>
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label">[(#{txt.fax})]</label>
                                                <input type="text" class="form-control num-integer" maxlength="8" th:field="*{fax}">
                                             </div>
                                          </div>
                                        <div>
                                          		<label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.tipo.plan})]</label>
                                                <select class="form-control _select2_" id="planes" th:field="*{provincia}"  required="required">
                                                <option value="" selected="selected" th:text="#{txt.combo.seleccione}"></option>
                                                <option th:each="k : ${listaPlanes}" th:value="${k.id}" th:text="${k.planes}"></option>	
                                                </select>
                                          </div>
                                           		<div class="col-md-2">
                                             	<div class="form-group">
                                                <label class="control-label">[(#{txt.tipo.plan1})]</label>
                                                <input type="text" class="form-control num-integer" maxlength="8" th:field="*{fax}" disabled="disabled">
                                             </div>
                                          </div>
                                           
                                          
                                          </div>
                                          
                                          
                                       <h3 class="title-border-bottom" th:text="#{txt.ubicacion.de.la.empresa}"></h3>
                                       <div class="row p-t-20">
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.provincia})]</label>
                                                <select class="form-control _select2_" id="provincia" th:field="*{provincia}"  required="required">
                                                   <option value="" selected="selected" th:text="#{txt.combo.seleccione}"></option>
                                                   <option th:each="k : ${listaProvincias}" th:value="${k.id}" th:text="${k.provincia}"></option>
                                                </select>
                                             </div>
                                          </div>
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.canton})]</label>
                                                <select class="form-control _select2_" id="canton" th:field="*{canton}" required="required">
                                                   <option th:each="k : ${listaCantones}" th:value="${k.id}" th:text="${k.canton}"></option>
                                                </select>
                                             </div>
                                          </div>
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.distrito})]</label>
                                                <select class="form-control _select2_" th:field="*{distrito}" id="distrito" required="required">
                                                   <option th:each="k : ${listaDistritos}" th:value="${k.id}" th:text="${k.distrito}"></option>
                                                </select>
                                             </div>
                                          </div>
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i>[(#{txt.barrio})]	</label>
                                                <select class="form-control _select2_" id="barrio" th:field="*{barrio}">
                                                   <option value="">Opcional</option>
                                                   <option th:each="k : ${listaBarrios}" th:value="${k.id}" th:text="${k.barrio}"></option>
                                                </select>
                                             </div>
                                          </div>
                                          <div class="col-md-12">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.otras.senas})]</label>
                                                <input type="text" class="form-control" th:field="*{otrasSenas}" required="required">
                                             </div>
                                          </div>
                                          
                                          
                                           </div>
                                          
                                          
                                       <h3 class="title-border-bottom" th:text="#{txt.parametros.de.la.empresa}"></h3>
                                       <div class="row p-t-20">
                                        
                                          <div class="col-md-12">
                                             <div class="form-group">
                                                <label class="control-label">[(#{txt.detalle.factura1})]</label>
                                                <textarea rows="2" cols="" class="form-control" th:field="*{detalleEnFactura1}"></textarea>
                                             </div>
                                          </div>
                                          <div class="col-md-12">
                                             <div class="form-group">
                                                <label class="control-label">[(#{txt.detalle.factura2})]</label>
                                                <textarea rows="2" cols="" class="form-control" th:field="*{detalleEnFactura2}"></textarea>
                                             </div>
                                          </div>
                                          <div class="col-md-12">
                                             <div class="form-group">
                                                <label class="control-label" th:text="'Validez de la proforma'"></label>
                                                <textarea rows="2" cols="" class="form-control" th:field="*{notaValidezProforma}"></textarea>
                                             </div>
                                          </div>
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.ambiente.trabajo})]</label>
                                                <select class="form-control _select2_" th:field="*{ambiente}" required="required">                                                   
                                                   <option th:value="'prod'" th:text="#{txt.ambiente.prod}"></option>
                                                   <option sec:authorize="hasAnyRole('ROLE_SUPER_ADMIN', 'ROLE_ADMIN')" th:value="'stag'" th:text="#{txt.ambiente.stag}"></option>  
                                                </select>
                                             </div>
                                          </div>
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.status.empresa})]</label>
                                                <select class="form-control _select2_" th:field="*{statusEmpresa}" required="required">
                                                   <option th:value="'1'" th:text="#{txt.estado.activo}"></option>
                                                   <option th:value="'0'" th:text="#{txt.estado.desactivado}"></option>
                                                </select>
                                             </div>
                                          </div>
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.email.notificaciones})]</label>
                                                <input type="email" class="form-control" th:field="*{emailNotificacion}" required="required">
                                             </div>
                                          </div>
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.impresion})]</label>
                                                <select class="form-control _select2_" th:field="*{impresion}" required="required">
                                                   <option th:value="'1'" th:text="#{txt.carta}"></option>
                                                   <option th:value="'2'" th:text="#{txt.tiquete}"></option>
                                                </select>
                                             </div>
                                          </div>
                                          
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> Decimales</label>
                                                <input type="text" maxlength="1" class="form-control" name="decimales" value="2" required="required">
                                             </div>
                                          </div>
                                          
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> Control cajas</label>
                                                <select class="form-control _select2_" th:field="*{controlCajas}" required="required">
                                                   <option th:value="'N'" th:text="'No'"></option>
                                                   <option th:value="'S'" th:text="'Si'"></option>
                                                </select>
                                             </div>
                                          </div>
                                          
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> Multi-moneda factura</label>
                                                <select class="form-control _select2_" th:field="*{multiMonedaFactura}" required="required">
                                                   <option th:value="'N'" th:text="'No'"></option>
                                                   <option th:value="'S'" th:text="'Si'"></option>
                                                </select>
                                             </div>
                                          </div>
                                          
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> Devolucion IVA</label>
                                                <select class="form-control _select2_" th:field="*{devolucionIva}" required="required">
                                                   <option th:value="'N'" th:text="'No'"></option>
                                                   <option th:value="'S'" th:text="'Si'"></option>
                                                </select>
                                             </div>
                                          </div>
                                          
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> Sistema farmacias</label>
                                                <select class="form-control _select2_" th:field="*{sistemaFarmacias}" required="required">
                                                   <option th:value="'N'" th:text="'No'"></option>
                                                   <option th:value="'S'" th:text="'Si'"></option>
                                                </select>
                                             </div>
                                          </div>
                                          
                                       </div>
                                       <h3 class="title-border-bottom" th:text="#{txt.usuario.pw.mh}"></h3>

                                       <div class="row">
                                          <div class="col-md-6">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.user.api.prod})]</label>
                                                <input type="text" class="form-control" th:field="*{userApi}" required="required">
                                             </div>
                                          </div>
                                          <div class="col-md-4">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.pw.api.prod})]</label>
                                                <input type="text" class="form-control" th:field="*{pwApi}" required="required">
                                             </div>
                                          </div>
                                          <div class="col-md-2">
                                             <div class="form-group">
                                                <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.ping.api.prod})]</label>
                                                <input type="text" class="form-control" maxlength="4" th:field="*{pingApi}" required="required">
                                             </div>
                                          </div>
                                       </div>
                                       <div class="form-actions align-center">
                                       	  <input type="hidden" name="tipoCliente" value="A" />
                                          <button type="submit" class="btn btn-success btn-lg"> <i class="fas fa-save"></i>&nbsp;<span th:text="#{btn.guardar}"></span></button>
                                          <a th:href="@{/emisor/}" class="btn btn-inverse btn-lg" style="color:#FFF !important"><i class="fas fa-chevron-left"></i>&nbsp; <span th:text="#{txt.btn-regresar}"></span></a>
                                       </div>
                                    </div>
                                    
                                 </div>
                              </div>
                        </form>
                     </div>
                  </div>
               </div>
               <!-- ============================================================== -->
               <!-- End PAge Content -->
               <!-- ============================================================== -->
            </div>
            <!-- ============================================================== -->
            <!-- End Container fluid  -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- footer -->
            <!-- ============================================================== -->
            <footer th:replace="layout/layout :: footer"></footer>
            <!-- ============================================================== -->
            <!-- End footer -->
            <!-- ============================================================== -->
         </div>
         <!-- ============================================================== -->
         <!-- End Page wrapper  -->
         <!-- ============================================================== -->
      </div>
      <div class="modal fade modal-sucursal" tabindex="-1" role="dialog">
         <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" id="loadFormSucursal"></div>
         </div>
      </div>
      <div class="modal fade modal-terminal" tabindex="-1" role="dialog">
         <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" id="loadFormTerminal"></div>
         </div>
      </div>
      
      
      <div class="modal fade modal-nuevo-acceso" tabindex="-1" role="dialog">
         <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" id="loadFormNuevoAcceso"></div>
         </div>
      </div>
      
      <input id="csrfToken" type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
      <div th:replace="layout/layout :: scripts"></div>
      <script type="text/javascript">
          var token = $('#csrfToken').val();
		
          $(document).on('change', '#tipoDeIdentificacion', function () {
        		
        	    var v = $(this).val();
        	    
        	    $("#identificacion").val("");
        	    
        	    if(v != ""){
        	        $("#identificacion").removeAttr("disabled");
        	    }else{
        	        $("#identificacion").attr("disabled", true);
        	    }
        	    
        	    if(v == "1"){
        	        //fisico
        	        $("#identificacion").attr('maxlength','9');
        	    }else if(v == "2"){
        	        //juricio
        	        $("#identificacion").attr('maxlength','10');
        	    }else{
        	        $("#identificacion").attr('maxlength','12');
        	        $("#identificacion").removeClass("iden_fisica");
        	        $("#identificacion").removeClass("iden_juridica");
        	    }
        	    
        	    if ($(this).val() != "") {
        	        $(".error").fadeOut();
        	        return false;
        	    }
        	    
        	});

        	$("#formEmpresa").submit(function( event ) {
        		
        		//Valido las cédulas
        		var v = $("#tipoDeIdentificacion").val();
        		var i = $("#identificacion").val();
        		if(v == "1"){
        			
        			//fisico
        			if(i.length != 9){
        				
        				swal({
        				    text: "¡La cédula física debe contener 9 dígitos, sin espacios y sin guiones!",
        				    button: {
        				        text: "Aceptar",
        				      },
        				      icon: "warning",
        				    closeModal: false
        				}).then(function() {
        				        swal.close();
        				        $("#identificacion").focus();
        				});
        				
        				return false;
        			}
        	        
        	    }else if(v == "2"){
        	        //juricio
        	        if(i.length != 10){
        				
        				swal({
        				    text: "¡La cédula jurídica debe contener 10 dígitos, sin espacios y sin guiones!",
        				    button: {
        				        text: "Aceptar",
        				      },
        				      icon: "warning",
        				    closeModal: false
        				}).then(function() {
        				        swal.close();
        				        $("#identificacion").focus();
        				});
        				
        				return false;
        			}
        	    }
        		
        		//Valido los teléfonos
        		var tel1 = $("#telefono").val();
        		if(tel1.length != 8){

        			swal({
        			    text: "¡El número de teléfono debe contener 8 dígitos, sin espacios y sin guiones!",
        			    button: {
        			        text: "Aceptar",
        			      },
        			      icon: "warning",
        			    closeModal: false
        			}).then(function() {
        			        swal.close();
        			        $("#telefono").focus();
        			});
        			
        			return false;
        		}
        		
        		
        	});

        	$(document).on("change","#provincia", function(e){
        			
        		  e.preventDefault();

        		  $.ajax({
        		      type: "POST",
        		      cache: false,
        		      beforeSend: function () {},
        		      url: "[(@{/ubicacion/cantones})]",
        		      data: {id:$(this).val(), _csrf:token},
        		      success: function (data)
        		      {
        		      	$("#canton").html(data);     
        		      	$('#canton').select2('open');
        		      }, complete: function () {
        		          //loading_hide();
        		      }, error: function (x, t, m) {
        		          if (t === "timeout") {
        		              
        		          } else {
        		              
        		          }
        		      }
        		  });
        		  
        	});

        	$(document).on("change","#canton", function(e){
        		
        		  e.preventDefault();

        		  $.ajax({
        		      type: "POST",
        		      cache: false,
        		      beforeSend: function () {},
        		      url: "[(@{/ubicacion/distritos})]",
        		      data: {id:$(this).val(), _csrf:token},
        		      success: function (data)
        		      {
        		      	$("#distrito").html(data);      
        		      	$('#distrito').select2('open');
        		      }, complete: function () {
        		          //loading_hide();
        		      }, error: function (x, t, m) {
        		          if (t === "timeout") {
        		              
        		          } else {
        		              
        		          }
        		      }
        		  });
        		  
        	});

        	$(document).on("change","#distrito", function(e){
        		
        		  e.preventDefault();

        		  $.ajax({
        		      type: "POST",
        		      cache: false,
        		      beforeSend: function () {},
        		      url: "[(@{/ubicacion/barrios})]",
        		      data: {id:$(this).val(), _csrf:token},
        		      success: function (data)
        		      {
        		      	$("#barrio").html(data);     
        		      	$('#barrio').select2('open');
        		      }, complete: function () {
        		          //loading_hide();
        		      }, error: function (x, t, m) {
        		          if (t === "timeout") {
        		              
        		          } else {
        		              
        		          }
        		      }
        		  });
        		  
        	});
				
			
	  </script>
   </body>
</html>