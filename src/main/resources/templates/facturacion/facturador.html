<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="layout/layout :: head"></head>

<body class="fix-header card-no-border logo-center">
    <div id="main-wrapper">
        <header th:replace="layout/layout :: header"></header>
        <aside th:replace="layout/layout :: aside"></aside>
        <!-- ============================================================== -->
        <!-- Page wrapper  -->
        
        <!-- ============================================================== -->
        <div class="page-wrapper m-t-10">
            <!-- ============================================================== -->
            <!-- Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- End Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- Container fluid  -->
            <!-- ============================================================== -->
            <div class="container-fluid">
                <!-- ============================================================== -->
                <!-- Start Page Content -->
                <!-- ============================================================== -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body card-body-facturador">
                                <form id="formEmitirFactura" autocomplete="off" method="post">
                                    <div class="form-body">

                                        <div class="row">
                                            <div class="col-md-5 ">
                                                <h4 class="card-title" th:text="#{txt.informacion.basica}"></h4>
                                            </div>

                                            <div class="col-md-5">
                                                <h6 class="card-title"><i class="fa fa-building" aria-hidden="true"></i>&nbsp<span th:text="${SESSION_SUCURSAL}" th:remove="tag"></span> / <i class="fas fa-cash-register"></i>&nbsp;<span th:remove="tag" th:text="${SESSION_TERMINAL}"></span></h6>
                                            </div>

                                            <div class="col-md-2 align-right">
                                                <a style="color:#FFFFFF !important;" class="btn waves-effect waves-light btn-success btn-xs btn-terminales" th:href="@{/facturar/seleccionar-terminal}">
                                                    <i class="fas fa-cash-register"></i>&nbsp; [(#{btn.terminales})]
                                                </a>
                                            </div>

                                        </div>
                                        <hr class="linea-horizontal">
                                        <div class="row">

                                            <div class="col-sm-4 col-md-2" th:if="${jose}">
                                                <div class="form-group">
                                                    <label class="control-label" th:text="'Situación'"></label>
                                                    <select class="form-control _select21_" name="situacion" required="required">
                                                        <option th:value="'normal'" th:text="#{txt.situacion.normal}"></option>
                                                        <option th:value="'contingencia'" th:text="#{txt.situacion.contingencia}"></option>
                                                        <option th:value="'sininternet'" th:text="#{txt.situacion.sininternet}"></option>
                                                    </select>
                                                </div>
                                            </div>

                                            <input type="hidden" name="situacion" value="normal" />

                                            <div class="col-sm-6 col-md-1">
                                                <div class="form-group">
                                                    <label class="control-label" th:text="#{txt.moneda}"></label>
                                                    <select class="form-control _select2_" name="moneda" id="codMoneda" required="required">
                                                        <option th:each="k : ${listaMonedas}" th:value="${k.id}" th:attr="selected=${k.id == MONEDA_USUARIO ? 'selected' : null}" th:text="${k.simboloMoneda}"></option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-sm-6 col-md-1">
                                                <div class="form-group" style="position: relative;">
                                                    <label class="control-label" th:text="#{txt.tipo.de.cambio}"></label>
                                                    <input type="text" readonly="readonly" class="form-control" onkeypress="return validateFloatKeyPress(this,event);" value="1.00" id="tipoCambio" name="tipoCambio" required="required">

                                                </div>
                                            </div>
                                            <div class="col-sm-12 col-md-5">
                                                <div class="form-group" style="position: relative;">
                                                    <label class="control-label" th:text="'Actividades económicas'"></label>
                                                    <select class="form-control _select2_" name="codigoActividadEmisor" id="codigoActividadEmisor" required="required">
                                                        <option th:attr="selected=${k.codigoActividadEmisor == session.SESSION_ACTIVIDAD_DEFAULT ? 'selected' : null}" th:each="k : ${listaActividades}" th:value="${k.codigoActividadEmisor}" th:text="${k.detalleActividad}"></option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="col-sm-6 col-md-2">
                                                <div class="form-group">
                                                    <label class="control-label" th:text="#{txt.tipo.de.documento}"></label>
                                                    <select class="form-control _select21_" name="tipoDocumento" id="tipoDocumento" required="required">
                                                        <option th:attr="selected=${'FE' == TIPO_DOC_USUARIO ? 'selected' : null}" th:value="'FE'" th:text="#{txt.fe}"></option>
                                                        <option sec:authorize="hasAnyRole('ROLE_ADMIN','ROLE_USER')" th:attr="selected=${'ND' == TIPO_DOC_USUARIO ? 'selected' : null}" th:value="'ND'" th:text="#{txt.nd}"></option>
                                                        <option sec:authorize="hasAnyRole('ROLE_ADMIN','ROLE_USER')" th:attr="selected=${'NC' == TIPO_DOC_USUARIO ? 'selected' : null}" th:value="'NC'" th:text="#{txt.nc}"></option>
                                                        <option th:attr="selected=${'TE' == TIPO_DOC_USUARIO ? 'selected' : null}" th:value="'TE'" th:text="#{txt.te}"></option>
                                                        <option sec:authorize="hasAnyRole('ROLE_ADMIN','ROLE_USER')" th:attr="selected=${'FEC' == TIPO_DOC_USUARIO ? 'selected' : null}" th:value="'FEC'" th:text="#{txt.fec}"></option>
                                                        <option th:attr="selected=${'FEE' == TIPO_DOC_USUARIO ? 'selected' : null}" th:value="'FEE'" th:text="#{txt.fee}"></option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            </div>
                                            <hr class="linea-horizontal">
											<div class="row">
                                            <div class="col-sm-6 col-md-2">
                                                <div class="form-group">
                                                    <label class="control-label">[(#{txt.incluir.omitir})]</label>
                                                    <select class="form-control _select21_" id="omitirReceptor" name="omitirReceptor" required="required">
                                                        <option class="receptor-false" th:attr="selected=${'false' == INCLUIR_OMITIR_RECEPTOR ? 'selected' : null}" th:value="'false'" th:text="#{txt.no.omitir.receptor}"></option>
                                                        <option class="receptor-true" th:attr="selected=${'true' == INCLUIR_OMITIR_RECEPTOR ? 'selected' : null}" th:value="'true'" th:text="#{txt.omitir.receptor}"></option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-6 col-lg-4 datos-cliente" th:style="${'false' == INCLUIR_OMITIR_RECEPTOR ? 'display:block' : 'display:none'}">
		                                       <div class="form-group">
		                                          <label class="control-label" id="labelBuscarClienteProveedor">F6 - [(#{txt.busque.el.cliente})]</label>
		                                          <input type="hidden" id="inputClientesTipoIdentificacionHidden" />
		                                          <input type="hidden" id="inputClientesHidden" name="receptor" />
		                                          <input type="search" id="inputBuscarClientes" onclick="return this.select();"  class="form-control" th:attr="placeholder=#{txt.digite.nombre.cliente}">
		                                          <a data-toggle="modal" data-target="#ModalNuevoCliente" class="btn btn-secondary btn-xs btn-cliente" href="#">
		                                          <i th:attr="title=#{txt.agregar.nuevo.cliente}" data-toggle="tooltip" data-placement="top" class="fas fa-plus"></i> Registrar cliente
		                                          </a>
		                                       </div>
		                                    </div>
		                                    <div class="col-md-3 datos-cliente" th:style="${'false' == INCLUIR_OMITIR_RECEPTOR ? 'display:block' : 'display:none'}">
		                                       <div class="form-group">
		                                          <label class="control-label">Correo</label>
		                                          <input type="email" id="inputCorreoCliente" class="form-control" onclick="return this.select();" th:attr="placeholder='Correo electrónico'" name="correoCliente">
		                                       </div>
		                                    </div>
		
		                                    <div id="boxInputClienteContado" th:style="${'true' == INCLUIR_OMITIR_RECEPTOR ? 'display:block' : 'display:none'}" class="col-md-3">
		                                       <div class="form-group">
		                                          <label class="control-label">Cliente de contado</label>
		                                          <input type="text" id="inputClienteContado" name="inputClienteContado" onclick="return this.select();"  class="form-control" th:attr="placeholder='Nombre cliente de contado, campo opcional'">
		                                       </div>
		                                    </div>
		                                    <div id="boxInputCorreoContado" th:style="${'true' == INCLUIR_OMITIR_RECEPTOR ? 'display:block' : 'display:none'}" class="col-md-3">
		                                       <div class="form-group">
		                                          <label class="control-label">Envíar tiquete por correo</label>
		                                          <input type="text" id="inputCorreoContado" name="inputCorreoContado" onclick="return this.select();"  class="form-control" th:attr="placeholder='Correo electrónico cliente de contado, campo opcional'">
		                                       </div>
		                                    </div>

                                        </div>

                                        <input th:id="'moneda' + ${k.moneda.id}" th:attr="name='tp-'+${k.moneda.id}" type="hidden" th:each="k : ${listaTiposDeCambio}" th:value="${k.tipoDeCambio}" />

                                        <ul class="lista-tipo-cambio">
                                            [(#{txt.tipo.de.cambio.moneda})]
                                            <li th:each="k : ${listaTiposDeCambio}">
                                                <a href="#">[(${k.moneda.simboloMoneda}+' '+${#numbers.formatDecimal(k.tipoDeCambio, 0, 'COMMA', 2, 'POINT')})]</a>
                                            </li>
                                        </ul>
                                        <hr class="linea-horizontal">

                                        <div class="row">
                                            <div class="col-md-12">
           
                                                <hr class="linea-horizontal">
				                                 <div class="row">
				                                    <div class="col-md-3 col-lg-3">
				                                       <div class="" style="text-align: center;">
				                                          <input name="tipoBusqueda" type="radio" class="_tipoBusquedaProductos" value="S" id="tipoBusquedaS" th:checked="${TIPO_BUSQUEDA_PRODUCTO == 'S'}">
				                                          <label for="tipoBusquedaS">Escaner</label>
				                                          <input name="tipoBusqueda" type="radio" class="_tipoBusquedaProductos" value="M" id="tipoBusquedaM" th:checked="${TIPO_BUSQUEDA_PRODUCTO == 'M'}">
				                                          <label for="tipoBusquedaM">Manual</label>
				                                       </div>
				                                    </div>
				                                    <div class="col-md-9 col-lg-9">
				                                       <div class="form-group" style="position:relative">
				                                       	  <label class="txtLineasFactura">F7 - [(#{txt.lineas.factura})]</label>
				                                          <input autofocus="autofocus" type="search" th:style="${TIPO_BUSQUEDA_PRODUCTO == 'S' ? 'display:block' : 'display:none'}" id="inputBuscarProductos"       onclick="return this.select();" class="form-control tipoBusquedaProductos" placeholder="Escanear código del producto">
				                                          <input autofocus="autofocus" type="search" th:style="${TIPO_BUSQUEDA_PRODUCTO == 'M' ? 'display:block' : 'display:none'}" id="inputBuscarProductosManual" onclick="return this.select();" class="form-control tipoBusquedaProductos" placeholder="Digite el código o el nombre del producto">
				                                       </div>
				                                    </div>
				                                 </div>

                                                <div class="table-responsive">
                                                    <table id="cargarItemProductos" class="table color-bordered-table muted-bordered-table">
                                                        <thead>
                                                            <tr>
                                                                <th style="width: 5%" th:text="#{txt.factura.form.item.codigo}"></th>
                                                                <th style="width: 20%" th:text="#{txt.factura.form.item.producto}+' - '+#{txt.factura.form.item.unidad.de.medida}"></th>
                                                                <th style="width: 7%" th:text="#{txt.factura.form.item.cantidad}"></th>
                                                                <th class="align-right" style="width: 8%">Precio con IVA</th>
                                                                <th class="align-right" style="width: 4%">Exonerar</th>

                                                                <!--  <th style="width: 10%;" th:text="#{txt.factura.form.item.descuento}"></th>
		                                       <th class="align-right " style="width: 8%; " th:text="#{txt.factura.form.item.subtotal}"></th>
		                                       <th style="width: 10%; " th:text="#{txt.factura.form.item.impuesto}"></th>-->
                                                                <th class="align-right" style="width: 8%">Total linea con IVA</th>
                                                                <th style="width: 2%"></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="loadLineasFactura">
                                                        </tbody>
                                                        <tfoot>
				                                       	<tr>
				                                       		<td colspan="7"> 
				                                       			<span class="font-weight-bold">Total de lineas:</span> <span class="badge badge-warning font-weight-bold" id="totalLineasFactura"></span> / <span class="font-weight-bold font-weight-bold">Cantidad productos:</span> <span class="badge badge-warning" id="totalProductos"></span>
				                                       		</td>
				                                       	</tr>
				                                       </tfoot>
                                                    </table>
                                                </div>
                                            </div>
                                            

                                        </div>
                                        
                                        <nav>
										  <div class="nav nav-tabs" id="nav-tab" role="tablist">
										    <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-observaciones" role="tab" aria-controls="nav-observaciones" aria-selected="true">Observaciones</a>
										    <a class="nav-item nav-link" id="nav-exoneracion-tab" data-toggle="tab" href="#nav-exoneracion" role="tab" aria-controls="nav-exoneracion" aria-selected="false">Exoneración</a>
										    <a class="nav-item nav-link" id="nav-referencias-tab" data-toggle="tab" href="#nav-referencias" role="tab" aria-controls="nav-referencias" aria-selected="false">Referencia a otros documentos</a>
										    <a class="nav-item nav-link" id="nav-otros-cargos-tab" data-toggle="tab" href="#nav-otros-cargos" role="tab" aria-controls="nav-otros-cargos" aria-selected="false">Otros cargos</a>
										    
										  </div>
										</nav>
										<div class="tab-content" id="nav-tabContent">
										  <div class="tab-pane fade show active" id="nav-observaciones" role="tabpanel" aria-labelledby="nav-observaciones">
	
										  		<div class="row m-t-10">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                        	<label class="control-label">Agregue una observación o nota a la factura</label>
                                                            <textarea rows="2" cols="" name="notaFactura" class="form-control" maxlength="255" th:attr="placeholder=#{txt.observacion.factura}"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
										  		
										  </div>
										  <div class="tab-pane fade" id="nav-exoneracion" role="tabpanel" aria-labelledby="nav-exoneracion-tab">
										  		<div class="row">
		                                            <div class="col-md-12">
		                                                <h4 class="card-title p-t-10" th:text="'Exoneración'"></h4>
		                                            </div>
		
		                                            <div class="col-sm-2 col-md-3">
		                                                <div class="form-group">
		                                                    <label class="control-label" th:text="'Tipo de exoneración exoneración'"></label>
		                                                    <select name="exoneraTipoDocumentoExonera" id="exoneraTipoDocumentoExonera" class="form-control _select21_">
		                                                        <option value="" selected="">Seleccione un elemento</option>
		                                                        <option th:each="j : ${listaTipoDocsExonera}" th:value="${j.id}" th:text="${j.exoneracionOAutorizacion}"></option>
		                                                    </select>
		                                                </div>
		                                            </div>
		                                            <div class="col-sm-2 col-md-3">
		                                                <div class="form-group">
		                                                    <label class="control-label" th:text="'Número de documento de exoneración'"></label>
		                                                    <input maxlength="40" name="exoneraNumero" id="exoneraNumero" onclick="return this.select();" placeholder="Digite número de documento de exoneración" type="text" class="form-control">
		
		                                                </div>
		                                            </div>
		
		                                            <div class="col-sm-2 col-md-3">
		                                                <div class="form-group">
		                                                    <label class="control-label" th:text="'Nombre de institución que exonera'"></label>
		                                                    <input maxlength="160" name="exoneraInstitucion" id="exoneraInstitucion" onclick="return this.select();" placeholder="Digite nombre de institución que exonera" type="text" class="form-control">
		
		                                                </div>
		                                            </div>
		
		                                            <div class="col-sm-2 col-md-3">
		                                                <div class="form-group">
		                                                    <label class="control-label" th:text="'Fecha emsión documento de exoneración'"></label>
		                                                    <div class="input-group">
		                                                        <input type="text" name="exoneraFechaEmision" id="exoneraFechaEmision" class="form-control align-right dd-mm-yyyy" placeholder="dd/mm/yyyy"><span class="input-group-addon"><i class="fa fa-calendar"
											                    aria-hidden="true"></i></span>
		                                                    </div>
		                                                </div>
		                                            </div>
		                                        </div>
										  </div>
										  <div class="tab-pane fade" id="nav-referencias" role="tabpanel" aria-labelledby="nav-referencias-tab">
										  		<div class="row">
		                                            <div class="col-md-10">
		                                                <h4 class="card-title p-t-10" th:text="#{txt.referencia}"></h4>
		                                            </div>
		
		                                            <div class="col-md-2">
		                                                <div class="align-right">
		                                                    <button class="btn btn-success btn-xs m-10" id="btnAgregarReferencia" type="button">
		                                                        <i class="fas fa-plus"></i>&nbsp; [(#{txt.agregar.referencia})]
		                                                    </button>
		                                                </div>
		                                                <input type="hidden" id="countReferencia" value="0" />
		                                            </div>
		                                        </div>
		                                        
		                                        <div id="contentWrapReferencias"></div>
		                                        
										  </div>
										  <div class="tab-pane fade" id="nav-otros-cargos" role="tabpanel" aria-labelledby="nav-otros-cargos-tab">
										  
										  		<div class="row">
		                                            <div class="col-md-10">
		                                                <h4 class="card-title p-t-10" th:text="#{txt.otros.cargos}"></h4>
		                                            </div>
		
		                                            <div class="col-md-2">
		                                                <div class="align-right">
		                                                    <button class="btn btn-success btn-xs m-10" id="btnAgregarOtrosCargos" type="button">
		                                                        <i class="fas fa-plus"></i>&nbsp; [(#{txt.agregar.otros.cargos})]
		                                                    </button>
		                                                </div>
		                                                <input type="hidden" id="countOtrosCargos" value="0" />
		                                            </div>
		                                        </div>
		
		                                        <div id="contentWrapOtrosCargos"></div>
										  
										  </div>
										</div>

                                        <div class="row">
                                            
                                            <div class="col-md-8" style="display:none;">
                                                <h4 class="card-title p-t-10" th:text="#{txt.resumen.de.la.factura}"></h4>
                                                <hr class="linea-horizontal">

                                                <input readonly="readonly" type="hidden" class="form-control align-right resumen-factura number-format" value="0" name="totalServiciosGravados" id="totalServiciosGravados">
                                                <input readonly="readonly" type="hidden" class="form-control align-right resumen-factura number-format" value="0" name="totalServiciosExentos" id="totalServiciosExentos">
                                                <input readonly="readonly" type="hidden" class="form-control align-right resumen-factura number-format" value="0" name="totalServiciosExonerado" id="totalServiciosExonerado">
                                                <input readonly="readonly" type="hidden" class="form-control align-right resumen-factura number-format" value="0" name="totalMercanciaGravadas" id="totalMercanciaGravadas">
                                                <input readonly="readonly" type="hidden" class="form-control align-right resumen-factura number-format" value="0" name="totalMercanciasExentas" id="totalMercanciasExentas">
                                                <input readonly="readonly" type="hidden" class="form-control align-right resumen-factura number-format" value="0" name="totalMercanciasExonerada" id="totalMercanciasExonerada">

                                                <div class="row">

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.gravados}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" name="totalGravados" id="totalGravados">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.exentos}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" name="totalExentos" id="totalExentos">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.exonerado}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" name="totalExonerado" id="totalExonerado">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.venta}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" name="totalVenta" id="totalVenta">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.descuentos}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" name="descuentos" id="descuentos">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.venta.neta}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" name="totalVentaNeta" id="totalVentaNeta">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.impuestos}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" name="totalImpuestos" id="totalImpuestos">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.iva.devuelto}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" name="totalIVADevuelto" id="totalIVADevuelto">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group sumary-factura">
                                                            <label class="control-label" th:text="#{txt.total.otros.cargos}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" name="totalOtrosCargos" id="totalOtrosCargos">
                                                            </div>
                                                        </div>

                                                        <div class="form-group sumary-factura">
                                                            <label style="border-top:2px solid gray; width: 100%;" class="control-label p-t-10" th:text="#{txt.total.comprobante}"></label>
                                                            <div class="input-group">
                                                                <span class="input-group-addon simbolo-moneda"></span>
                                                                <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" name="totalFactura" id="totalFactura">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-actions emitir-factura ">
                                            <input id="csrfToken" type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                                            <div class="modal fade" id="modalPagar" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">

                                                            <h4 class="documentoAGenerar modal-title" style="margin-bottom:0 !important">Se va a generar un(a) <span id="documentoAGenerar"></span></h4>

                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body">

                                                            <div class="row">
                                             <div class="col-md-6">
                                                <div class="form-group">
                                                   <label class="control-label" th:text="#{txt.condicion.de.venta}"></label>
                                                   <select style="width: 100%" class="form-control _select21_" id="condVenta" name="condVenta" required="required">
                                                      <option th:each="k : ${listaCondicionDeVenta}" th:value="${k.id}" th:text="${k.condicionVenta}"></option>
                                                   </select>
                                                </div>
                                             </div>
                                             <div class="col-md-6">
                                                <div class="form-group">
                                                   <label class="control-label" th:text="#{txt.plazo.de.credito}"></label>
                                                   <input readonly="readonly" id="plazoCredito" name="plazoCredito" onclick="return this.select();" value="0" type="number" class="form-control">
                                                   <span style="display: none;" id="notificacionPlazoCredito"></span>
                                                </div>
                                             </div>
                                             <div th:if="${session.SESSION_APLICA_DEVOLUCION_IVA == 'S'}" class="col-md-12 m-t-10">
	                                            <div class="form-check">
												  <input class="form-check-input" type="checkbox" onchange="devolucionIva()" id="aplicarDevolucionIva">
												  <label class="form-check-label" for="aplicarDevolucionIva">
												    Aplicar devolución del IVA
												  </label>
												</div> 
	                                        </div>
                                             <div class="col-md-6 ivaDevuelto"  style="display: none;">
                                                <div class="form-group sumary-factura">
                                                   <label class="control-label" style="text-align: left; width: 100%;">IVA devuelto</label>
                                                   <div class="input-group"> 
                                                      <span class="input-group-addon simbolo-moneda"></span>
                                                      <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format-final" value="0.00" id="ivaDevuelto">
                                                   </div>
                                                </div>
                                             </div>
                                             <div class="col-md-6">
                                                <div class="form-group sumary-factura">
                                                   <label class="control-label" style="text-align: left; width: 100%;">[(#{txt.total.a.pagar})]</label>
                                                   <div class="input-group"> 
                                                      <span class="input-group-addon simbolo-moneda"></span>
                                                      <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format-final" value="0.00" id="totalAPagar">
                                                   </div>
                                                </div>
                                             </div>
                                             
                                             <div class="col-md-12 condicion-venta">
                                             	<p class="bg-warning font-weight-bold" style="color:#000000; margin-bottom:5px !important; padding:4px !important;">Digite el monto del dinero recibido para calcular el vuelto.</p>

                                             </div>

                                                                <div class="col-md-12 condicion-venta">

                                                                    <ul class="nav nav-tabs customtab" role="tablist">
                                                                        <li class="nav-item"><a class="nav-link pago-colones" th:classappend="${MONEDA_USUARIO} == 1 ? active : ''" data-toggle="tab" href="#colones" role="tab" aria-selected="false"><span class="hidden-sm-up"><i class="ti-home"></i></span> <span class="hidden-xs-down">¢ Colones</span></a></li>
                                                                        <li class="nav-item"><a class="nav-link pago-dolares" th:classappend="${MONEDA_USUARIO} == 2 ? active : ''" data-toggle="tab" href="#dolares" role="tab" aria-selected="false"><span class="hidden-sm-up"><i class="ti-user"></i></span> <span class="hidden-xs-down">$ Dolares</span></a> </li>
                                                                        <li class="nav-item"><a class="nav-link pago-euros" th:classappend="${MONEDA_USUARIO} == 3 ? active : ''" data-toggle="tab" href="#euros" role="tab" aria-selected="true"><span class="hidden-sm-up"><i class="ti-email"></i></span> <span class="hidden-xs-down">€ Euros</span></a> </li>
                                                                    </ul>

                                                                    <div class="tab-content">
                                                                        <div class="tab-pane pago-colones" th:classappend="${MONEDA_USUARIO} == 1 ? active : ''" id="colones" role="tabpanel">
                                                                            <div class="row m-t-10">
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'¢ Efectivo'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPago1" id="medioPago1" onclick="return this.select();" class="form-control medioPago align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'¢ Tarjeta'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPago2" id="medioPago2" onclick="return this.select();" class="form-control medioPago align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'¢ Cheque'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPago3" id="medioPago3" onclick="return this.select();" class="form-control medioPago align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'¢ Transferencia - depósito bancario'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPago4" id="medioPago4" onclick="return this.select();" class="form-control medioPago align-right" value="0">
                                                                                    </div>
                                                                                </div>

                                                                                <div style="display:none" class="col-md-6 medio-pago-tarjeta">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="#{txt.ultimos.4.digitos.tarjeta}"></label>
                                                                                        <input name="numeroTarjeta" maxlength="4" onclick="return this.select();" type="text" class="input-medio-pago-tarjeta form-control num-integer">
                                                                                    </div>
                                                                                </div>
                                                                                <div style="display:none" class="col-md-6 medio-pago-tarjeta">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="#{txt.numero.autorizacion}"></label>
                                                                                        <input name="numeroAutorizacion" maxlength="50" onclick="return this.select();" type="text" class="input-medio-pago-tarjeta form-control ">
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="tab-pane pago-dolares" id="dolares" th:classappend="${MONEDA_USUARIO} == 2 ? active : ''" role="tabpanel">
                                                                            <div class="row m-t-10">
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'$ Efectivo'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoDolar1" id="medioPagoDolar1" onclick="return this.select();" class="form-control medioPagoDolar align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'$ Tarjeta'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoDolar2" id="medioPagoDolar2" onclick="return this.select();" class="form-control medioPagoDolar align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'$ Cheque'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoDolar3" id="medioPagoDolar3" onclick="return this.select();" class="form-control medioPagoDolar align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'$ Transferencia - depósito bancario'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoDolar4" id="medioPagoDolar4" onclick="return this.select();" class="form-control medioPagoDolar align-right" value="0">
                                                                                    </div>
                                                                                </div>

                                                                                <div style="display:none" class="col-md-6 medio-pago-tarjeta-dolar">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="#{txt.ultimos.4.digitos.tarjeta}"></label>
                                                                                        <input name="numeroTarjetaDolar" maxlength="4" onclick="return this.select();" type="text" class="input-medio-pago-tarjeta-dolar form-control num-integer">
                                                                                    </div>
                                                                                </div>
                                                                                <div style="display:none" class="col-md-6 medio-pago-tarjeta-dolar">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="#{txt.numero.autorizacion}"></label>
                                                                                        <input name="numeroAutorizacionDolar" maxlength="50" onclick="return this.select();" type="text" class="input-medio-pago-tarjeta-dolar form-control ">
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="tab-pane pago-euros" th:classappend="${MONEDA_USUARIO} == 3 ? active : ''" id="euros" role="tabpanel">

                                                                            <div class="row m-t-10">
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'€ Efectivo'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoEuro1" id="medioPagoEuro1" onclick="return this.select();" class="form-control medioPagoEuro align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'€ Tarjeta'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoEuro2" id="medioPagoEuro2" onclick="return this.select();" class="form-control medioPagoEuro align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'€ Cheque'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoEuro3" id="medioPagoEuro3" onclick="return this.select();" class="form-control medioPagoEuro align-right" value="0">
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-6 col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="'€ Transferencia - depósito bancario'"></label>
                                                                                        <input type="text" onkeypress="return validateFloatKeyPress(this,event);" name="medioPagoEuro4" id="medioPagoEuro4" onclick="return this.select();" class="form-control medioPagoEuro align-right" value="0">
                                                                                    </div>
                                                                                </div>

                                                                                <div style="display:none" class="col-md-6 medio-pago-tarjeta-euro">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="#{txt.ultimos.4.digitos.tarjeta}"></label>
                                                                                        <input name="numeroTarjetaEuro" maxlength="4" onclick="return this.select();" type="text" class="input-medio-pago-tarjeta-euro form-control num-integer">
                                                                                    </div>
                                                                                </div>
                                                                                <div style="display:none" class="col-md-6 medio-pago-tarjeta-euro">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label" th:text="#{txt.numero.autorizacion}"></label>
                                                                                        <input name="numeroAutorizacionEuro" maxlength="50" onclick="return this.select();" type="text" class="input-medio-pago-tarjeta-euro form-control ">
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>

                                                            <!-- 
			                                 <div class="col-md-12">

		                                          <div class="form-group sumary-factura">
		                                            <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.pago.con})]</label>
		                                            <div class="input-group"> 
        									 			<span class="input-group-addon simbolo-moneda"></span>
		                                             	<input type="text" onkeypress="return validateFloatKeyPress(this,event);" class="form-control align-right number-format-final resumen-factura" onclick="return this.select();" name="pagoCon" value="0.00" style="background-color: #FFF !important;color:gray !important" id="pagoCon" required="required">
		                                          	</div>
		                                          </div>
		                                       </div>
		                                        -->
                                                            <hr class="condicion-venta">
                                                            <div class="row condicion-venta">

                                                                <div class="col-6 col-md-4">
                                                                    <div class="form-group">
                                                                        <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.su.vuelto})]: colones</label>
                                                                        <div class="input-group">
                                                                            <span class="input-group-addon">¢</span>
                                                                            <input readonly="readonly" type="text" name="suVuelto" class="form-control align-right resumen-factura number-format-final suVuelto" value="0" autofocus>

                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-6 col-md-4">
                                                                    <div class="form-group">
                                                                        <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.su.vuelto})]: dolares</label>
                                                                        <div class="input-group">
                                                                            <span class="input-group-addon">$</span>
                                                                            <input readonly="readonly" type="text" name="suVueltoDolar" class="form-control align-right resumen-factura number-format-final suVueltoDolar" value="0" autofocus>

                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <div class="form-group">
                                                                        <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.su.vuelto})]: euros</label>
                                                                        <div class="input-group">
                                                                            <span class="input-group-addon">€</span>
                                                                            <input readonly="readonly" type="text" name="suVueltoEuro" class="form-control align-right resumen-factura number-format-final suVueltoEuro" value="0" autofocus>

                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>

                                                        </div>
                                                        <div class="modal-footer">

                                                            <div class="row">
                                                            	<div class="col-12 col-md-4 m-t-10">
                                                            		<button type="button" class="btn btn-inverse btn-block btn-lg m-10" data-dismiss="modal">
	                                                                    <i class="fa fa-ban" aria-hidden="true"></i>&nbsp; <span th:text="#{btn.cancelar}"></span>
	                                                                </button>
                                                            	</div>
                                                            	<div class="col-12 col-md-8 m-t-10">
                                                            		<button id="btnEmitirFactura" type="submit" class="btn btn-success btn-block btn-lg m-10">
	                                                                    <i class="fa fa-shopping-cart" aria-hidden="true"></i>&nbsp;F10 - <span th:text="#{btn.emitir.factura}"></span>
	                                                                </button>
                                                            	</div>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="modal fade" id="modalFinVenta" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true">
                                                <div>
                                                    <div class="modal-dialog" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title"><strong>Venta finalizada</strong></h5>
                                                                <button type="button" class="close reload-page" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">

                                                                <div class="row">

                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.su.vuelto})]: colones</label>
                                                                            <div class="input-group">
                                                                                <span class="input-group-addon">¢</span>
                                                                                <input readonly="readonly" type="text" name="suVuelto" class="form-control align-right resumen-factura number-format-final suVuelto" value="0" autofocus>

                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.su.vuelto})]: dolares</label>
                                                                            <div class="input-group">
                                                                                <span class="input-group-addon">$</span>
                                                                                <input readonly="readonly" type="text" name="suVueltoDolar" class="form-control align-right resumen-factura number-format-final suVueltoDolar" value="0" autofocus>

                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.su.vuelto})]: euros</label>
                                                                            <div class="input-group">
                                                                                <span class="input-group-addon">€</span>
                                                                                <input readonly="readonly" type="text" name="suVueltoEuro" class="form-control align-right resumen-factura number-format-final suVueltoEuro" value="0" autofocus>

                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <div class="col-md-12">
                                                                        <div class="form-group">
                                                                            <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.clave})]</label>
                                                                            <input id="responseClave" readonly="readonly" type="text" class="form-control resumen-factura  align-right">
                                                                        </div>
                                                                    </div>

                                                                    <div class="col-md-12">
                                                                        <div class="form-group">
                                                                            <label style="text-align: left; width: 100%;" class="control-label">[(#{txt.consecutivo})]</label>
                                                                            <input id="responseConsecutivo" readonly="readonly" type="text" class="form-control resumen-factura align-right">
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                            <div class="modal-footer ">

                                                                <div class="align-center">

                                                                    <a class="btn btn-info btn-lg m-b-10 btn-block" id="btnNuevaFacturacion" th:href="@{/facturar/}" style="color:#FFF !important">
															        	F5 - <i class="fas fa-file-invoice"></i>&nbsp; <span th:text="#{btn.seguir.facturando}"></span>
															        </a>
															        
															        <div class="row">
															        	<div class="col-md-6">
															        		<button data-print="C" class="btn-imprimir-factura  btn-block btn-lg btn btn-success btn-block">
		                                                                        <i class="fas fa-print"></i>&nbsp;<span>Imprimir carta</span>
		                                                                    </button>
															        	</div>
															        	<div class="col-md-6">
															        		<button data-print="T" class="btn-imprimir-factura  btn-block btn-lg btn btn-primary btn-block">
		                                                                        <i class="fas fa-print"></i>&nbsp;<span>Imprimir tiquete</span>
		                                                                    </button>
															        	</div>
															        </div>
															        
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                        <div class="cajaTablaTotal">

                                            <div class="row">
                                                <div class="col-md-3"></div>
                                                <div class="col-md-1">
                                                    <a th:href="@{/facturar/}" class="btn-movil btn btn-outline-warning m-t-10" style="color:#FFF !important; margin-top:19px !important">
                                                        <i class="fas fa-broom"></i>&nbsp; F5
                                                    </a>
                                                </div>
                                                <div class="col-md-2">
                                                    <button style="margin-top:19px !important" id="btnModalPagar" type="button" class="btn-movil btn btn-block btn-outline-secondary m-t-10">
                                                        <i class="fas fa-money-check"></i></i>&nbsp;F9 - Cobrar
                                                    </button>
                                                </div>

                                                <div class="col-md-2">
                                                    <div class="form-group sumary-factura">
                                                        <label class="control-label" th:text="#{txt.total.venta}"></label>
                                                        <div class="input-group">
                                                            <span class="input-group-addon simbolo-moneda"></span>
                                                            <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" id="totalVentaSumary">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group sumary-factura">
                                                        <label class="control-label" th:text="#{txt.total.impuestos}"></label>
                                                        <div class="input-group">
                                                            <span class="input-group-addon simbolo-moneda"></span>
                                                            <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" id="totalImpuestosSumary">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group sumary-factura">
                                                        <label class="control-label" th:text="#{txt.total.comprobante}"></label>
                                                        <div class="input-group">
                                                            <span class="input-group-addon simbolo-moneda"></span>
                                                            <input readonly="readonly" type="text" class="form-control align-right resumen-factura number-format" value="0" id="totalFacturaSumary">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>

                                </form>

                                </div>
                            </div>
                        </div>
                        <!-- ============================================================== -->
                        <!-- End PAge Content -->
                        <!-- ============================================================== -->
                    </div>

                    <input type="hidden" value="" id="inputImprimirFactura">
                    <input type="hidden" value="" id="inputImprimirFacturaPdf">

                    <iframe style="width:100%; height:1px; display:none" id="IframeImprimirFactura" frameBorder="0" allowfullscreen></iframe>

                    <table th:replace="facturacion/plantilla-items :: itemsFactura"></table>

                    <div id="itemsOtrosCargos" class="d-none">
                        <div class="row" id="otrosCargos{R_ID}">
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.otros.cargos.tipo.documento})]</label>
                                    <select style="width: 100%" class="form-control comboOtrosCargosTipoDoc" data-id="{R_ID}" id="otrosCargosTipoDoc{R_ID}" name="otrosCargosTipoDoc[]" required="required">
                                        <option value="" selected="" th:text="#{txt.combo.seleccione}"></option>
                                        <option th:each="k : ${listaTipoDocOtrosCargos}" th:value="${k.id}" th:text="${k.tipoDocumento}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.otros.cargos.identificacion})]</label>
                                    <input type="text" readonly="readonly" id="otrosCargosIdentificacion{R_ID}" name="otrosCargosIdentificacion[]" maxlength="12" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.otros.cargos.nombre})]</label>
                                    <input type="text" readonly="readonly" id="otrosCargosNombre{R_ID}" name="otrosCargosNombre[]" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.otros.cargos.detalle})]</label>
                                    <input type="text" id="otrosCargosDetalle{R_ID}" maxlength="160" placeholder="Digite el detalle" name="otrosCargosDetalle[]" class="form-control" required="required">
                                </div>
                            </div>
                            <div class="col-md-1">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.otros.cargos.porcentaje})]</label>
                                    <input type="text" id="otrosCargosPorcentaje{R_ID}" maxlength="3" placeholder="" name="otrosCargosPorcentaje[]" class="form-control num-integer">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group" style="position: relative">
                                    <label class="control-label">[(#{txt.otros.cargos.monto})]</label>
                                    <input type="text" id="otrosCargosMontoCargo{R_ID}" onkeypress="return validateFloatKeyPress(this,event);" maxlength="20" placeholder="Monto total del cargo" name="otrosCargosMonto[]" class="form-control inputOtrosCargos" required="required">

                                    <button class="deleteOtrosCargos btn btn-danger btn-xs" title="Eliminar linea" data-id="{R_ID}" type="button">
                                        <i class="fa fa-trash" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="itemsReferencia" class="d-none">
                        <div class="row" id="referencia{R_ID}">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="control-label">Clave documento o consecutivo de referencia</label>
                                    <input type="text" maxlength="50" id="referenciaClaveDocumento{R_ID}" placeholder="Digite la clave de la factura original, o consecutivo de referencia" name="referenciaClaveDocumento[]" class="form-control" required="required">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="control-label">Tipo referencia documento</label>
                                    <select style="width: 100%" class="form-control" id="referenciaTipoDoc{R_ID}" name="referenciaTipoDoc[]" required="required">
                                        <option value="" selected="selected" th:text="#{txt.combo.seleccione}"></option>
                                        <option th:each="k : ${listaTipoDocReferencia}" th:value="${k.id}" th:text="${k.documentoReferencia}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.fecha.de.emision})]</label>
                                    <div class="input-group">
                                        <input type="text" id="referenciaFechaDeEmision{R_ID}" name="referenciaFechaDeEmision[]" class="form-control align-right dd-mm-yyyy" placeholder="dd/mm/yyyy" required="required">
                                        <span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="control-label">[(#{txt.codigo})]</label>
                                    <select style="width: 100%" class="form-control" id="referenciaCodigoDocumento{R_ID}" name="referenciaCodigoDocumento[]" required="required">
                                        <option value="" selected="selected" th:text="#{txt.combo.seleccione}"></option>
                                        <option th:each="k : ${listaCodigoReferencia}" th:value="${k.id}" th:text="${k.descripcionReferencia}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group" style="position:relative">
                                    <label class="control-label">[(#{txt.razon})]</label>
                                    <input type="text" id="referenciaRazonDocumento{R_ID}" maxlength="160" placeholder="Digite la razón de referencia" name="referenciaRazonDocumento[]" class="form-control" required="required">

                                    <button class="deleteReferencia btn btn-danger btn-xs " title="Eliminar la referencia" data-id="{R_ID}" type="button">
                                        <i class="fa fa-trash" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div data-backdrop="static" data-keyboard="false" class="modal fade" id="ModalNuevoCliente" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                            <form id="formAddCliente" autocomplete="off" th:action="@{/clientes/form/save}" th:object="${cliente}" method="post">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">[(#{txt.registrar.cliente})]</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">

                                        <div class="form-body">

                                            <div style="margin: 0 !important" class="row p-t-20 card-body-facturador">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Buscar cliente por número de identificación</label>
                                                        <input onclick="return this.select();" type="text" placeholder="Digite la identificación" id="buscarClienteApi" maxlength="20" class="form-control num-integer">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.tipo.identificacion})]</label>
                                                        <select class="form-control _select2_ width100" th:field="*{tipoDeIdentificacion}" required="required">
                                                            <option value="" selected="selected" th:text="#{txt.combo.seleccione}"></option>
                                                            <option th:each="k : ${listaTipoDeIdentificacion}" th:value="${k.id}" th:text="${k.tipoDeIdentificacion}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.identificacion})]</label>

                                                        <input th:if="${cliente.tipoDeIdentificacion == null}" type="text" th:attr="maxlength=9" class="form-control num-integer" th:field="*{identificacion}" required="required">

                                                    </div>
                                                </div>
                                                <div class="col-sm-8 col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.nombre.completo})]</label>
                                                        <input type="text" maxlength="80" class="form-control" th:field="*{nombreCompleto}" required="required">
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.codigo.pais}"></label>
                                                        <input type="text" maxlength="3" class="form-control num-integer" value="506" th:field="*{codigoPais}">
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.telefono1}"></label>
                                                        <input th:attr="maxlength=${cliente.tipoDeIdentificacion != null && cliente.tipoDeIdentificacion.id > 2 ?  20 : 8}" type="text" class="form-control num-integer" th:field="*{telefono1}">
                                                    </div>
                                                </div>
                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.telefono2}"></label>
                                                        <input type="text" th:attr="maxlength=${cliente.tipoDeIdentificacion != null && cliente.tipoDeIdentificacion.id > 2 ?  20 : 8}" class="form-control num-integer" th:field="*{telefono2}">
                                                    </div>
                                                </div>

                                                <div class="col-sm-4 col-md-2">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.fax}"></label>
                                                        <input th:attr="maxlength=${cliente.tipoDeIdentificacion != null && cliente.tipoDeIdentificacion.id > 2 ?  20 : 8}" type="text" maxlength="8" class="form-control" th:field="*{fax}">
                                                    </div>
                                                </div>

                                                <div class="col-sm-8 col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label"><i class="fas fa-asterisk color-rojo"></i> [(#{txt.correo1})]</label>
                                                        <input type="email" maxlength="150" class="form-control" th:field="*{correo1}" required="required">
                                                    </div>
                                                </div>

                                                <div class="col-sm-8 col-md-4">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.correo2}"></label>
                                                        <input type="email" maxlength="150" class="form-control" th:field="*{correo2}">
                                                    </div>
                                                </div>
                                                
                                                <div class="col-md-2">
			                                          <div class="form-group">
			                                              <label class="control-label" th:text="'Días crédito'"></label>
			                                              <input type="text" class="form-control" th:field="*{diasCredito}">
			                                          </div>
			                                      </div>
			                                      <div class="col-md-2">
			                                          <div class="form-group">
			                                              <label class="control-label" th:text="'Estado crédito'"></label>
			                                              <select class="form-control _select2_" th:field="*{estadoCredito}">
			                                                  <option value="C">Cancelado</option>
			                                                  <option value="A">Activo</option>			                                                  
			                                              </select>
			                                          </div>
			                                      </div>

                                            </div>

                                            <hr class="linea-horizontal">
                                                                   
                                                <h4>Datos de exoneración</h4>
                                                
                                                <div class="row">
                                                	<div class="col-md-1">
                                                        <div class="form-group">
                                                            <label class="control-label">Ley</label>
                                                            <input type="text" class="form-control" maxlength="25" th:field="*{ley}">
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-2 col-md-3">
		                                                <div class="form-group">
		                                                    <label class="control-label" th:text="'Tipo de exoneración exoneración'"></label>
		                                                    <select name="exoneraTipoDocumentoExonera" th:field="*{tipoDocumentoExoneracionOAutorizacion}" class="form-control _select2_">
		                                                        <option value="" selected="">Seleccione un elemento</option>
		                                                        <option th:each="j : ${listaTipoDocsExonera}" th:value="${j.id}" th:text="${j.exoneracionOAutorizacion}"></option>
		                                                    </select>
		                                                </div>
		                                            </div>
                                                	<div class="col-md-2">
                                                        <div class="form-group">
                                                            <label class="control-label">Número de exoneración</label>
                                                            <input type="text" class="form-control" maxlength="17" th:field="*{numeroDocumento}">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <label class="control-label">Institución que exonera</label>
                                                            <input type="text" class="form-control" maxlength="100" th:field="*{nombreInstitucion}">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <div class="form-group">
                                                            <label class="control-label">Porcentaje exoneración</label>
                                                            <input type="text" class="form-control" maxlength="100" th:field="*{porcentajeExoneracion}">
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-2 col-md-4">
				                                       <div class="form-group">
				                                          <label class="control-label">Fecha emsión de exoneración</label>
				                                          <div class="input-group">
				                                             <input type="text" th:field="*{fechaInicioExoneracion}" class="form-control align-right dd-mm-yyyy" placeholder="dd/mm/yyyy"><span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
				                                          </div>
				                                       </div>
				                                    </div>
				                                    <div class="col-sm-2 col-md-4">
				                                       <div class="form-group">
				                                          <label class="control-label">Fecha final de exoneración</label>
				                                          <div class="input-group">
				                                             <input type="text" th:field="*{fechaFinExoneracion}" class="form-control align-right dd-mm-yyyy" placeholder="dd/mm/yyyy"><span class="input-group-addon"><i class="fa fa-calendar" aria-hidden="true"></i></span>
				                                          </div>
				                                       </div>
				                                    </div>
                                                </div>
		                             
		                             <hr>

                                            <h5 th:text="#{txt.datos.ubicacion.opcionales}"></h5>

                                            <div class="row">

                                                <div class="col-sm-6 col-md-3">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.provincia}"></label>
                                                        <select class="form-control _select2_ width100" th:field="*{provincia}">
                                                            <option th:value="''" selected="selected" th:text="#{txt.combo.seleccione}"></option>
                                                            <option th:each="k : ${listaProvincias}" th:value="${k.id}" th:text="${k.provincia}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 col-md-3">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.canton}"></label>
                                                        <select class="form-control _select2_ width100" th:field="*{canton}">
                                                            <option th:each="k : ${listaCantones}" th:value="${k.id}" th:text="${k.canton}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 col-md-3">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.distrito}"></label>
                                                        <select class="form-control _select2_ width100" id="distrito" th:field="*{distrito}">
                                                            <option th:each="k : ${listaDistritos}" th:value="${k.id}" th:text="${k.distrito}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 col-md-3">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.barrio}"></label>
                                                        <select class="form-control _select2_ width100" id="barrio" th:field="*{barrio}">
                                                            <option th:each="k : ${listaBarrios}" th:value="${k.id}" th:text="${k.barrio}"></option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <label class="control-label" th:text="#{txt.direccion}"></label>
                                                        <input type="text" class="form-control" maxlength="255" th:field="*{otrasSenas}">
                                                    </div>
                                                </div>

                                            </div>

                                        </div>

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-inverse" data-dismiss="modal">
                                            <i class="fa fa-ban" aria-hidden="true"></i> [(#{btn.cancelar})]
                                        </button>
                                        <input type="hidden" class="form-control" value="" id="formGuardar" th:field="*{id}">
                                        <button type="submit" class="btn btn-success">
                                            <i class="fas fa-save"></i>&nbsp;<span th:text="#{btn.guardar}"></span>
                                        </button>
                                    </div>
                            </form>
                            </div>
                        </div>
                    </div>

                    <!-- ============================================================== -->
                    <!-- End Container fluid  -->
                    <!-- ============================================================== -->
                    <!-- ============================================================== -->
                    <!-- footer -->
                    <!-- ============================================================== -->
                    <footer th:replace="layout/layout :: footer"></footer>
                    <!-- ============================================================== -->
                    <!-- End footer -->
                    <!-- ============================================================== -->
                    <input id="csrfToken" type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                </div>
                <!-- ============================================================== -->
                <!-- End Page wrapper  -->
                <!-- ============================================================== -->
            </div>
            
             <div class="modal fade modalImpuestos" tabindex="-1" role="dialog">
			  <div class="modal-dialog" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h5 class="modal-title" id="exampleModalLongTitle">Modificar impuesto</h5>
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
			      </div>
			      <div class="modal-body">
			        <div class="row">
			        	<div class="col-md-12">
                            <div class="form-group">
                               <label class="control-label">Impuesto</label>
                               <select id="tipoImpuesto" class="form-control">
                               		<option th:each="k : ${listaImpuestos}" th:attr="data-di=${k.detalleImpuesto}" th:value="${k.id}">[(${k.detalleImpuesto})]</option>
                               </select>
                            </div>
                         </div>
                         <div class="col-md-12">
                            <div class="form-group">
                               <label class="control-label">Tarifa impuesto IVA</label>
                               <select id="tarifaImpuesto" class="form-control">
                               		<option th:each="k : ${listaCodigosTarifasIva}" th:attr="data-tarifa=${k.tarifa}" th:value="${k.id}">[(${k.detalleTarifaImpuestoIva})]</option>
                               </select>
                            </div>
                         </div>
			        </div>
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-inverse" data-dismiss="modal"><i class="fas fa-window-close"></i> Cerrar</button>
			        
			        <input type="hidden" id="_productoId">
			        <input type="hidden" id="_impuestoId">
			        <input type="hidden" id="_tarifaImpuestoId">
			        <button type="button" id="btnAplicarImpuesto" class="btn btn-success"><i class="fas fa-save"></i> Aplicar</button>
			      </div>
			    </div>
			  </div>
			</div>

            <div th:replace="layout/layout :: scripts"></div>
            <div th:replace="facturacion/scriptFacturador :: scriptFacturacionFracmento"></div>
</body>

</html>